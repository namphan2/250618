<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch th∆∞ m·ª•c & H∆∞·ªõng d·∫´n</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0; 
      background: #f9f9f9; 
    }
    
    /* Navigation Bar */
    .navbar {
      background: #2c3e50;
      padding: 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
    }
    
    .nav-item {
      position: relative;
    }
    
    .nav-link {
      color: white;
      text-decoration: none;
      padding: 20px 25px;
      display: block;
      transition: background-color 0.3s;
    }
    
    .nav-link:hover {
      background-color: #34495e;
    }
    
    .nav-link.active {
      background-color: #3498db;
    }
    
    /* Dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 200px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .dropdown:hover .dropdown-content {
      display: block;
    }
    
    .dropdown-content a {
      color: #333;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      border-bottom: 1px solid #eee;
    }
    
    .dropdown-content a:hover {
      background-color: #3498db;
      color: white;
    }
    
    .dropdown-content a:last-child {
      border-bottom: none;
    }
    
    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Charts Tab */
    .charts-content {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0001;
      padding: 32px;
    }
    
    .chart-container {
      margin-bottom: 40px;
    }
    
    .chart-title {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    
    .chart-wrapper {
      position: relative;
      height: 400px;
      margin-bottom: 30px;
    }
    
    /* Folder List */
    ul.folder-list { 
      list-style: none; 
      padding: 0; 
      margin-bottom: 40px; 
    }
    
    ul.folder-list li { 
      margin: 8px 0; 
    }
    
    ul.folder-list li a { 
      text-decoration: none; 
      color: #2980b9; 
      font-weight: bold; 
    }
    
    ul.folder-list li a:hover { 
      text-decoration: underline; 
    }
    
    /* Readme Content */
    .readme-content { 
      background: #fff; 
      border-radius: 8px; 
      box-shadow: 0 2px 8px #0001; 
      padding: 32px; 
    }
    
    .readme-content h1, .readme-content h2, .readme-content h3 { 
      color: #34495e; 
    }
    
    .readme-content ul { 
      margin-left: 24px; 
    }
    
    .readme-content blockquote { 
      color: #888; 
      border-left: 4px solid #eee; 
      margin: 16px 0; 
      padding-left: 16px; 
    }
    
    .readme-content hr { 
      border: none; 
      border-top: 1px solid #eee; 
      margin: 24px 0; 
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-item">
        <a href="#" class="nav-link active" onclick="showTab('charts')">Bi·ªÉu ƒë·ªì</a>
      </div>
      <div class="nav-item">
        <a href="#" class="nav-link" onclick="showTab('detail')">Chi ti·∫øt</a>
      </div>
      <div class="nav-item">
        <a href="#" class="nav-link" onclick="showTab('guide')">H∆∞·ªõng d·∫´n</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Charts Tab -->
    <div id="charts" class="tab-content active">
      <div class="charts-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h1>Bi·ªÉu ƒê·ªì So S√°nh Coverage üìä</h1>
          <button onclick="refreshData()" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px;">
            üîÑ L√†m m·ªõi d·ªØ li·ªáu
          </button>
        </div>
        <p>Bi·ªÉu ƒë·ªì d∆∞·ªõi ƒë√¢y hi·ªÉn th·ªã s·ª± thay ƒë·ªïi c√°c ch·ªâ s·ªë coverage gi·ªØa c√°c th∆∞ m·ª•c:</p>
        
        <div class="chart-container">
          <div class="chart-title">Class Coverage (%)</div>
          <div class="chart-wrapper">
            <canvas id="classChart"></canvas>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-title">Method Coverage (%)</div>
          <div class="chart-wrapper">
            <canvas id="methodChart"></canvas>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-title">Branch Coverage (%)</div>
          <div class="chart-wrapper">
            <canvas id="branchChart"></canvas>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-title">Line Coverage (%)</div>
          <div class="chart-wrapper">
            <canvas id="lineChart"></canvas>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-title">Instruction Coverage (%)</div>
          <div class="chart-wrapper">
            <canvas id="instructionChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Chi ti·∫øt Tab -->
    <div id="detail" class="tab-content">
      <div id="detail-content" class="readme-content" style="padding:0; background:none; box-shadow:none;">
        <p>ƒêang t·∫£i n·ªôi dung chi ti·∫øt...</p>
      </div>
    </div>

    <!-- Guide Tab -->
    <div id="guide" class="tab-content">
      <div class="readme-content">
        <h1>H∆∞·ªõng D·∫´n ƒê·ªçc Report HTML c·ªßa Kover (Kotlin) üëì</h1>
        <h2>1. Trang T·ªïng Quan (index.html)</h2>
        <ul>
          <li><b>Ngay khi m·ªü b√°o c√°o</b>, b·∫°n s·∫Ω th·∫•y b·∫£ng t·ªïng h·ª£p c√°c ch·ªâ s·ªë bao ph·ªß:
            <ul>
              <li><b>Class Coverage</b>: T·ª∑ l·ªá class ƒë√£ ƒë∆∞·ª£c ki·ªÉm th·ª≠</li>
              <li><b>Method Coverage</b>: T·ª∑ l·ªá method ƒë√£ ƒë∆∞·ª£c ki·ªÉm th·ª≠</li>
              <li><b>Line Coverage</b>: T·ª∑ l·ªá d√≤ng l·ªánh ƒë√£ ƒë∆∞·ª£c ki·ªÉm th·ª≠</li>
              <li><b>Branch Coverage</b>: T·ª∑ l·ªá nh√°nh ƒëi·ªÅu ki·ªán ƒë√£ ƒë∆∞·ª£c ki·ªÉm th·ª≠</li>
              <li><b>Instruction Coverage</b>: T·ª∑ l·ªá l·ªánh th·ª±c thi ƒë√£ ƒë∆∞·ª£c ki·ªÉm th·ª≠</li>
            </ul>
          </li>
          <li><b>M·ªói ch·ªâ s·ªë</b> ƒë·ªÅu c√≥ ph·∫ßn trƒÉm r√µ r√†ng, gi√∫p b·∫°n ƒë√°nh gi√° nhanh m·ª©c ƒë·ªô ki·ªÉm th·ª≠ c·ªßa d·ª± √°n.</li>
        </ul>
        <hr/>
        <h2>2. M√†u S·∫Øc Th·ªÉ Hi·ªán ƒê·ªô Bao Ph·ªß</h2>
        <ul>
          <li><b>Xanh l√°</b> üçÄ: ƒê√£ ki·ªÉm th·ª≠ ƒë·∫ßy ƒë·ªß (fully covered)</li>
          <li><b>V√†ng</b> üåï: ƒê∆∞·ª£c ki·ªÉm th·ª≠ m·ªôt ph·∫ßn (partially covered)</li>
          <li><b>ƒê·ªè</b> üî¥: Ch∆∞a ki·ªÉm th·ª≠ (uncovered)</li>
        </ul>
        <blockquote>Nh√¨n v√†o m√†u s·∫Øc, b·∫°n s·∫Ω bi·∫øt ngay ph·∫ßn n√†o c·ªßa m√£ ngu·ªìn ƒë√£ ƒë∆∞·ª£c ki·ªÉm th·ª≠ k·ªπ l∆∞·ª°ng v√† ph·∫ßn n√†o c√≤n thi·∫øu s√≥t.</blockquote>
        <hr/>
        <h2>3. Xem Chi Ti·∫øt Theo File/Class</h2>
        <ul>
          <li><b>Nh·∫•p v√†o t√™n package, class ho·∫∑c file</b> ƒë·ªÉ xem chi ti·∫øt.</li>
          <li><b>B·∫£ng chi ti·∫øt</b> s·∫Ω hi·ªán ra:
            <ul>
              <li>Danh s√°ch c√°c method v√† d√≤ng l·ªánh</li>
              <li>S·ªë l∆∞·ª£ng v√† t·ª∑ l·ªá d√≤ng/method ƒë∆∞·ª£c ki·ªÉm th·ª≠</li>
            </ul>
          </li>
          <li><b>C√°c d√≤ng m√£</b> s·∫Ω ƒë∆∞·ª£c ƒë√°nh d·∫•u m√†u t∆∞∆°ng ·ª©ng:
            <ul>
              <li>Xanh: ƒë√£ ch·∫°y qua khi test</li>
              <li>ƒê·ªè: ch∆∞a ch·∫°y qua khi test</li>
              <li>V√†ng: ch·ªâ m·ªôt ph·∫ßn ƒë∆∞·ª£c test (th∆∞·ªùng l√† c√°c nh√°nh ƒëi·ªÅu ki·ªán)</li>
            </ul>
          </li>
        </ul>
        <hr/>
        <h2>4. ƒêi·ªÅu H∆∞·ªõng Nhanh</h2>
        <ul>
          <li><b>Thanh b√™n tr√°i</b> (ho·∫∑c tr√™n c√πng) gi√∫p b·∫°n chuy·ªÉn nhanh gi·ªØa c√°c package, class, file.</li>
          <li><b>Nh·∫•p v√†o t·ª´ng m·ª•c</b> ƒë·ªÉ soi k·ªπ t·ª´ng ph·∫ßn c·ªßa d·ª± √°n.</li>
        </ul>
        <hr/>
        <h2>5. M·ªôt S·ªë M·∫πo ƒê·ªçc B√°o C√°o Hi·ªáu Qu·∫£</h2>
        <ul>
          <li><b>T·∫≠p trung v√†o c√°c v√πng m√†u ƒë·ªè/v√†ng</b> ƒë·ªÉ b·ªï sung test.</li>
          <li><b>So s√°nh c√°c ch·ªâ s·ªë coverage</b> gi·ªØa c√°c class ƒë·ªÉ x√°c ƒë·ªãnh ƒëi·ªÉm y·∫øu trong ki·ªÉm th·ª≠.</li>
          <li><b>Ki·ªÉm tra c√°c nh√°nh ƒëi·ªÅu ki·ªán</b> (if/else, when...) v√¨ ƒë√¢y l√† n∆°i d·ªÖ b·ªã b·ªè s√≥t test nh·∫•t.</li>
        </ul>
        <hr/>
        <blockquote><b>T√≥m l·∫°i:</b><br/>Ch·ªâ c·∫ßn m·ªü b√°o c√°o, nh√¨n m√†u s·∫Øc v√† c√°c ch·ªâ s·ªë ph·∫ßn trƒÉm, sau ƒë√≥ nh·∫•p v√†o t·ª´ng file/class ƒë·ªÉ xem chi ti·∫øt l√† b·∫°n ƒë√£ n·∫Øm ƒë∆∞·ª£c to√†n b·ªô ƒë·ªô bao ph·ªß ki·ªÉm th·ª≠ c·ªßa d·ª± √°n m√¨nh!</blockquote>
      </div>
    </div>
  </div>

  <script>
    // Function to show/hide tabs
    function showTab(tabName) {
      // ·∫®n t·∫•t c·∫£ tab content
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => {
        content.classList.remove('active');
      });
      
      // B·ªè active t·∫•t c·∫£ nav links
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.classList.remove('active');
      });
      
      // Hi·ªán tab ƒë∆∞·ª£c ch·ªçn
      document.getElementById(tabName).classList.add('active');
      
      // Active nav link t∆∞∆°ng ·ª©ng
      event.target.classList.add('active');
      
      // N·∫øu l√† tab charts, load charts
      if (tabName === 'charts') {
        loadCharts();
      }
      // N·∫øu l√† tab detail, load detail
      if (tabName === 'detail') {
        loadDetail();
      }
      // Tab guide kh√¥ng c·∫ßn x·ª≠ l√Ω ƒë·ªông
    }

    // Function to load and create charts
    async function loadCharts() {
      try {
        // Th√™m cache busting ƒë·ªÉ force reload
        const response = await fetch('./coverage_data.json?t=' + Date.now());
        const coverageData = await response.json();
        
        console.log('Loaded coverage data:', coverageData);
        
        const folders = Object.keys(coverageData);
        const metrics = ['Class', 'Method', 'Branch', 'Line', 'Instruction'];
        const colors = ['#3498db', '#e74c3c', '#f39c12', '#27ae60', '#9b59b6'];
        
        // Clear existing charts if any
        metrics.forEach((metric, index) => {
          const ctx = document.getElementById(`${metric.toLowerCase()}Chart`);
          if (ctx) {
            // Destroy existing chart if it exists
            if (ctx.chart) {
              ctx.chart.destroy();
            }
            
            const data = folders.map(folder => coverageData[folder][metric] || 0);
            
            ctx.chart = new Chart(ctx, {
              type: 'line',
              data: {
                labels: folders,
                datasets: [{
                  label: `${metric} Coverage (%)`,
                  data: data,
                  backgroundColor: colors[index] + '20',
                  borderColor: colors[index],
                  borderWidth: 3,
                  fill: true,
                  tension: 0.4,
                  pointBackgroundColor: colors[index],
                  pointBorderColor: '#fff',
                  pointBorderWidth: 2,
                  pointRadius: 6,
                  pointHoverRadius: 8
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                      display: true,
                      text: 'Coverage (%)'
                    },
                    grid: {
                      color: '#f0f0f0'
                    }
                  },
                  x: {
                    title: {
                      display: true,
                      text: 'Th∆∞ m·ª•c'
                    },
                    grid: {
                      color: '#f0f0f0'
                    }
                  }
                },
                plugins: {
                  legend: {
                    display: false
                  },
                  tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    callbacks: {
                      label: function(context) {
                        return `${context.dataset.label}: ${context.parsed.y}%`;
                      }
                    }
                  }
                },
                elements: {
                  point: {
                    hoverBackgroundColor: colors[index]
                  }
                }
              }
            });
          }
        });
        
      } catch (error) {
        console.error('L·ªói khi t·∫£i d·ªØ li·ªáu coverage:', error);
        document.getElementById('charts').innerHTML = '<div class="charts-content"><h1>L·ªói</h1><p>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu coverage. Vui l√≤ng ch·∫°y script parse_coverage.py tr∆∞·ªõc.</p></div>';
      }
    }

    // Function to refresh data (force reload)
    async function refreshData() {
      console.log('Refreshing data...');
      await loadCharts();
      console.log('Data refreshed successfully!');
    }

    // Function ƒë·ªÉ l·∫•y folder m·ªõi nh·∫•t (t√™n s·ªë l·ªõn nh·∫•t)
    async function getNewestFolder() {
      try {
        const response = await fetch('./folders.json?t=' + Date.now());
        const folders = await response.json();
        // L·ªçc t√™n s·ªë
        const numericFolders = folders.filter(f => /^\d+$/.test(f));
        if (numericFolders.length === 0) return null;
        numericFolders.sort();
        return numericFolders[numericFolders.length - 1];
      } catch (e) {
        // fallback c·ª©ng
        const fallbackFolders = ['250528', '250618', '250709'];
        const numericFolders = fallbackFolders.filter(f => /^\d+$/.test(f));
        if (numericFolders.length === 0) return null;
        numericFolders.sort();
        return numericFolders[numericFolders.length - 1];
      }
    }

    // Function ƒë·ªÉ load n·ªôi dung index.html c·ªßa folder m·ªõi nh·∫•t v√†o iframe
    async function loadDetail() {
      const detailDiv = document.getElementById('detail-content');
      detailDiv.innerHTML = '<p>ƒêang t·∫£i n·ªôi dung chi ti·∫øt...</p>';
      const newest = await getNewestFolder();
      if (!newest) {
        detailDiv.innerHTML = '<p>Kh√¥ng t√¨m th·∫•y folder n√†o.</p>';
        document.title = 'Chi ti·∫øt';
        return;
      }
      // ƒê·∫∑t title giao di·ªán
      document.title = `Chi ti·∫øt - ${newest}`;
      // Hi·ªÉn th·ªã t√™n folder ·ªü ƒë·∫ßu tab detail
      detailDiv.innerHTML = `<div style='padding:16px 0 8px 0; font-size:20px; font-weight:bold;'>Folder: ${newest}</div>` +
        `<iframe src="./${newest}/index.html?t=${Date.now()}" style="width:100%; min-height:80vh; border:none; background:white;"></iframe>`;
    }

    // Load folders and charts when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // B·ªè loadFolders
      loadCharts(); // Load charts immediately since it's the default tab
    });
  </script>
</body>
</html> 