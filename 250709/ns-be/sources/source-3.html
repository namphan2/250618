


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>MoMoCompose Coverage Report > VoucherDetailVM</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope: MoMoCompose<span class="separator">|</span>    <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">vn.momo.compose.payment.promotion.presentation.viewModel</a>
</div>

<h1>Coverage Summary for Class: VoucherDetailVM (vn.momo.compose.payment.promotion.presentation.viewModel)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">VoucherDetailVM</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/142)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/141)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1156)
  </span>
</td>
</tr>
  <tr>
    <td class="name">VoucherDetailVM$fetchVoucherDetail$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">VoucherDetailVM$fetchVoucherDetail$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/30)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">VoucherDetailVM$fetchVoucherDetail$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">VoucherDetailVM$getFooterButtonProps$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">VoucherDetailVM$onCollectVoucher$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">VoucherDetailVM$onCreate$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">VoucherDetailVM$special$$inlined$inject$default$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">VoucherDetailVM$special$$inlined$inject$default$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/25)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/144)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/154)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1242)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package vn.momo.compose.payment.promotion.presentation.viewModel
&nbsp;
&nbsp;import kotlinx.coroutines.delay
&nbsp;import kotlinx.coroutines.flow.catch
&nbsp;import kotlinx.coroutines.flow.launchIn
&nbsp;import kotlinx.coroutines.flow.onEach
&nbsp;import kotlinx.coroutines.flow.onStart
&nbsp;import kotlinx.coroutines.launch
&nbsp;import kotlinx.serialization.builtins.serializer
&nbsp;import kotlinx.serialization.json.buildJsonObject
&nbsp;import kotlinx.serialization.json.jsonObject
&nbsp;import kotlinx.serialization.json.put
&nbsp;import kotlinx.serialization.serializer
&nbsp;import org.jetbrains.compose.resources.StringResource
&nbsp;import org.jetbrains.compose.resources.getString
&nbsp;import org.koin.core.parameter.parametersOf
&nbsp;import org.koin.core.scope.Scope
&nbsp;import vn.momo.compose.payment.base.core.composeApi.ILogger
&nbsp;import vn.momo.compose.payment.base.core.composeApi.INavigator
&nbsp;import vn.momo.compose.payment.payx.presentation.viewModel.slices.ViewModel
&nbsp;import vn.momo.compose.payment.promotion.core.model.toTrackingParams
&nbsp;import vn.momo.compose.payment.promotion.data.constants.TrackingConst
&nbsp;import vn.momo.compose.payment.promotion.data.mappers.toVoucherBase
&nbsp;import vn.momo.compose.payment.promotion.data.mappers.toVoucherDTO
&nbsp;import vn.momo.compose.payment.promotion.domain.entities.VoucherBase
&nbsp;import vn.momo.compose.payment.promotion.domain.entities.VoucherDetailBackParams
&nbsp;import vn.momo.compose.payment.promotion.domain.entities.VoucherDetailParams
&nbsp;import vn.momo.compose.payment.promotion.domain.entities.VoucherLocalType
&nbsp;import vn.momo.compose.payment.promotion.domain.entities.VoucherStatus
&nbsp;import vn.momo.compose.payment.promotion.domain.repositories.IVoucherDetailRepository
&nbsp;import vn.momo.compose.payment.promotion.presentation.model.ChoosePromotionScreenProps
&nbsp;import vn.momo.compose.payment.promotion.presentation.model.FooterButtonProps
&nbsp;import vn.momo.compose.payment.promotion.presentation.model.HelpCenterParams
&nbsp;import vn.momo.compose.payment.promotion.presentation.view.assets.Images
&nbsp;import vn.momo.compose.payment.promotion.presentation.viewModel.delegate.IPromotionVMTracking
&nbsp;import vn.momo.compose.payment.promotion.presentation.viewModel.reducers.VoucherDetailReducer
&nbsp;import vn.momo.compose.payment.promotion.presentation.viewModel.slices.CollectVoucherSlice
&nbsp;import vn.momo.compose.payment.promotion.presentation.viewModel.slices.VoucherCoinSlice
&nbsp;import vn.momo.compose.resources.Res
&nbsp;import vn.momo.compose.resources.txtCollect
&nbsp;import vn.momo.compose.resources.txtExchangeNow
&nbsp;import vn.momo.compose.resources.txtUseLater
&nbsp;import vn.momo.compose.resources.txtUseNow
&nbsp;import vn.momo.compose.resources.voucherCollected
&nbsp;import vn.momo.compose.resources.voucherValidInDay
&nbsp;import vn.momo.compose.resources.voucherValidInDays
&nbsp;import vn.momo.compose.resources.voucherValidInHour
&nbsp;import vn.momo.compose.resources.voucherValidInMinute
&nbsp;import vn.momo.compose.resources.voucherValidInSecond
&nbsp;import vn.momo.compose.utils.TimeUtils
&nbsp;import vn.momo.compose.utils.datamapping.ModelConvertUtils
&nbsp;import vn.momo.compose.utils.emptyJsonObject
&nbsp;import vn.momo.kits.components.ButtonType
&nbsp;
&nbsp;class VoucherDetailVM(
<b class="nc">&nbsp;    private val koinScope: Scope,</b>
<b class="nc">&nbsp;    private val navigator: INavigator,</b>
<b class="nc">&nbsp;    private val logger: ILogger,</b>
<b class="nc">&nbsp;    private val voucherDetailRepository: IVoucherDetailRepository,</b>
<b class="nc">&nbsp;    private val screenProps: Map&lt;String, Any?&gt;? = null,</b>
<b class="nc">&nbsp;    private val promotionTracer: IPromotionVMTracking,</b>
<b class="nc">&nbsp;) : ViewModel&lt;VoucherDetailReducer.State, VoucherDetailReducer.Action, VoucherDetailReducer.Effect&gt;(</b>
<b class="nc">&nbsp;    VoucherDetailReducer.State(), VoucherDetailReducer()</b>
&nbsp;), IPromotionVMTracking by promotionTracer {
<b class="nc">&nbsp;    val params = VoucherDetailParams.fromMap(screenProps) ?: VoucherDetailParams()</b>
<b class="nc">&nbsp;    private val initialVoucher = params.voucher?.toVoucherBase()</b>
&nbsp;
&nbsp;    private var hasTrackedScreenInteracted: Boolean = false
<b class="nc">&nbsp;    private val trackingParams = params.toTrackingParams()</b>
&nbsp;
<b class="nc">&nbsp;    private val collectVoucherSlice by koinScope.inject&lt;CollectVoucherSlice&gt; {</b>
<b class="nc">&nbsp;        parametersOf(</b>
<b class="nc">&nbsp;            viewModelScope</b>
&nbsp;        )
&nbsp;    }
<b class="nc">&nbsp;    private val voucherCoinSlice by koinScope.inject&lt;VoucherCoinSlice&gt; {</b>
<b class="nc">&nbsp;        parametersOf(</b>
<b class="nc">&nbsp;            viewModelScope,</b>
<b class="nc">&nbsp;            ChoosePromotionScreenProps()</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    fun onCreate() {
<b class="nc">&nbsp;        logger.i(&quot;[VoucherDetailVM] onCreate ${params.toDebugString()}&quot;)</b>
&nbsp;
<b class="nc">&nbsp;        initializeTracking()</b>
<b class="nc">&nbsp;        trackDetailScreenDisplayed(trackingParams)</b>
&nbsp;
<b class="nc">&nbsp;        viewModelScope.launch {</b>
<b class="nc">&nbsp;            delay(TrackingConst.SCREEN_VIEWED_LENGTH)</b>
<b class="nc">&nbsp;            trackDetailScreenViewed(trackingParams)</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (initialVoucher?.ID != null &amp;&amp; !initialVoucher.descGift?.policyDesc.isNullOrBlank()) {</b>
<b class="nc">&nbsp;            dispatch(</b>
<b class="nc">&nbsp;                VoucherDetailReducer.Action.SetVoucherData(</b>
<b class="nc">&nbsp;                    initialVoucher</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;            if (!hasTrackedScreenInteracted) {</b>
<b class="nc">&nbsp;                hasTrackedScreenInteracted = true</b>
<b class="nc">&nbsp;                trackDetailScreenInteracted(trackingParams)</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            fetchVoucherDetail(this.params)</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun fetchVoucherDetail(params: VoucherDetailParams) {
<b class="nc">&nbsp;        voucherDetailRepository.getVoucherDetail(params).onStart {</b>
<b class="nc">&nbsp;            dispatch(VoucherDetailReducer.Action.SetIsLoading(true))</b>
<b class="nc">&nbsp;        }.onEach { voucherData -&gt;</b>
<b class="nc">&nbsp;            dispatch(VoucherDetailReducer.Action.SetIsLoading(false))</b>
<b class="nc">&nbsp;            dispatch(VoucherDetailReducer.Action.SetVoucherData(voucherData))</b>
&nbsp;
<b class="nc">&nbsp;            if (!hasTrackedScreenInteracted) {</b>
<b class="nc">&nbsp;                hasTrackedScreenInteracted = true</b>
<b class="nc">&nbsp;                trackDetailScreenInteracted(trackingParams)</b>
&nbsp;            }
<b class="nc">&nbsp;        }.catch { exception -&gt;</b>
<b class="nc">&nbsp;            logger.i(&quot;[VoucherDetailVM] fetchVoucherDetail error: ${exception.message}&quot;)</b>
<b class="nc">&nbsp;            dispatch(VoucherDetailReducer.Action.SetIsLoading(false))</b>
<b class="nc">&nbsp;        }.launchIn(viewModelScope)</b>
&nbsp;    }
&nbsp;
&nbsp;    fun goToSupportCenter() {
<b class="nc">&nbsp;        logger.i(&quot;[VoucherDetailVM] goToSupportCenter with ${state.value.voucherData?.ID}&quot;)</b>
<b class="nc">&nbsp;        trackDetailSupportButtonClicked(trackingParams)</b>
<b class="nc">&nbsp;        val params = HelpCenterParams(</b>
<b class="nc">&nbsp;            promotion = state.value.voucherData?.toVoucherDTO(),</b>
&nbsp;        )
<b class="nc">&nbsp;        navigator.navigateFeatureCode(</b>
<b class="nc">&nbsp;            &quot;helpcenter_problemlevel1&quot;,</b>
<b class="nc">&nbsp;            ModelConvertUtils.encodeToJson(serializer(), params)?.jsonObject ?: emptyJsonObject(),</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    fun getUpcomingUseTime(startVoucherTime: Double?): Pair&lt;StringResource, Int&gt;? {
<b class="nc">&nbsp;        val currentTime = TimeUtils.getCurrentTimeMillis()</b>
<b class="nc">&nbsp;        val difference = startVoucherTime?.minus(currentTime) ?: return null</b>
&nbsp;
<b class="nc">&nbsp;        if (difference &gt; 0) {</b>
<b class="nc">&nbsp;            val seconds = (difference / 1000).toInt()</b>
<b class="nc">&nbsp;            val minutes = seconds / 60</b>
<b class="nc">&nbsp;            val hours = minutes / 60</b>
<b class="nc">&nbsp;            val days = hours / 24</b>
&nbsp;
<b class="nc">&nbsp;            return when {</b>
<b class="nc">&nbsp;                days &gt;= 7 -&gt; Pair(Res.string.voucherValidInDay, days)</b>
<b class="nc">&nbsp;                hours in 1..23 -&gt; Pair(Res.string.voucherValidInHour, hours)</b>
<b class="nc">&nbsp;                minutes in 1..59 -&gt; Pair(Res.string.voucherValidInMinute, minutes)</b>
<b class="nc">&nbsp;                seconds in 1..59 -&gt; Pair(Res.string.voucherValidInSecond, seconds)</b>
<b class="nc">&nbsp;                else -&gt; Pair(Res.string.voucherValidInDays, days)</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return null</b>
&nbsp;    }
&nbsp;
&nbsp;    suspend fun getFooterButtonProps(): FooterButtonProps {
<b class="nc">&nbsp;        val status = state.value.voucherData?.status</b>
<b class="nc">&nbsp;        val localType = state.value.voucherData?.localType</b>
<b class="nc">&nbsp;        val isVoucherSelected = params.voucher?.selected == true</b>
<b class="nc">&nbsp;        val isVoucherMask = localType == VoucherLocalType.GiftMask</b>
<b class="nc">&nbsp;                || localType == VoucherLocalType.InvalidGiftMask</b>
<b class="nc">&nbsp;                || status == VoucherStatus.GiftMask.code</b>
<b class="nc">&nbsp;        val isVoucherCoin = status == VoucherStatus.VoucherCoin.code</b>
<b class="nc">&nbsp;        val isInvalidStatus = status == null || status == VoucherStatus.ConnectionError.code</b>
&nbsp;
<b class="nc">&nbsp;        val isDisabled =</b>
<b class="nc">&nbsp;            (params.voucher?.isDisabled == true &amp;&amp; !isVoucherMask &amp;&amp; !isVoucherCoin)</b>
<b class="nc">&nbsp;                    || localType == VoucherLocalType.Invalid</b>
<b class="nc">&nbsp;                    || getUpcomingUseTime(params.voucher?.startDate) != null</b>
<b class="nc">&nbsp;                    || initialVoucher?.localType == VoucherLocalType.InvalidVoucherCoin</b>
<b class="nc">&nbsp;                    || isInvalidStatus</b>
&nbsp;
<b class="nc">&nbsp;        logger.i(&quot;[VoucherDetailVM] footerButtonProps with $isVoucherSelected ${params.voucher?.isDisabled} $localType $status ${params.isInsufficientCoin}&quot;)</b>
&nbsp;
<b class="nc">&nbsp;        return FooterButtonProps(</b>
<b class="nc">&nbsp;            title = if (isVoucherMask) {</b>
<b class="nc">&nbsp;                getString(Res.string.txtCollect)</b>
<b class="nc">&nbsp;            } else if (isVoucherSelected &amp;&amp; params.fromSearch != true) {</b>
<b class="nc">&nbsp;                getString(Res.string.txtUseLater)</b>
<b class="nc">&nbsp;            } else if (isVoucherCoin) {</b>
<b class="nc">&nbsp;                getString(Res.string.txtExchangeNow)</b>
&nbsp;            } else {
<b class="nc">&nbsp;                getString(Res.string.txtUseNow)</b>
&nbsp;            },
<b class="nc">&nbsp;            type = if (isDisabled) {</b>
<b class="nc">&nbsp;                ButtonType.DISABLED</b>
&nbsp;            } else {
<b class="nc">&nbsp;                ButtonType.PRIMARY</b>
&nbsp;            },
<b class="nc">&nbsp;            onClick = {</b>
<b class="nc">&nbsp;                if (isVoucherMask) {</b>
<b class="nc">&nbsp;                    onCollectVoucher(state.value.voucherData as VoucherBase)</b>
<b class="nc">&nbsp;                } else if (params.fromSearch == true) {</b>
<b class="nc">&nbsp;                    onUseNow()</b>
<b class="nc">&nbsp;                } else if (isVoucherCoin) {</b>
<b class="nc">&nbsp;                    onClaimVoucher(state.value.voucherData as VoucherBase)</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    if (isVoucherSelected) {</b>
<b class="nc">&nbsp;                        onUseLater()</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        onUseNow()</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            },
&nbsp;        )
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    fun showToastMessage(type: String? = &quot;success&quot;, message: String?) {</b>
<b class="nc">&nbsp;        if (message?.isNotEmpty() == true) {</b>
<b class="nc">&nbsp;            navigator.showToast(</b>
<b class="nc">&nbsp;                buildJsonObject {</b>
<b class="nc">&nbsp;                    put(&quot;title&quot;, message)</b>
<b class="nc">&nbsp;                    put(&quot;type&quot;, type)</b>
<b class="nc">&nbsp;                    put(&quot;duration&quot;, 3000)</b>
<b class="nc">&nbsp;                    if (type == &quot;success&quot;) {</b>
<b class="nc">&nbsp;                        put(&quot;icon&quot;, Images.ic_info)</b>
&nbsp;                    }
<b class="nc">&nbsp;                }, String.serializer()</b>
<b class="nc">&nbsp;            ).launchIn(viewModelScope)</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun onCollectVoucher(voucher: VoucherBase) {
<b class="nc">&nbsp;        trackDetailButtonClicked(trackingParams, &quot;collect&quot;)</b>
<b class="nc">&nbsp;        collectVoucherSlice.onCollect(</b>
<b class="nc">&nbsp;            voucher,</b>
&nbsp;            onSuccess = {
<b class="nc">&nbsp;                dispatch(VoucherDetailReducer.Action.SetCollectedVoucher(it))</b>
<b class="nc">&nbsp;                dispatch(VoucherDetailReducer.Action.SetVoucherData(it))</b>
<b class="nc">&nbsp;                viewModelScope.launch {</b>
<b class="nc">&nbsp;                    showToastMessage(</b>
<b class="nc">&nbsp;                        message = getString(Res.string.voucherCollected),</b>
<b class="nc">&nbsp;                        type = &quot;success&quot;</b>
&nbsp;                    )
&nbsp;                }
&nbsp;            }
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    private fun onClaimVoucher(voucher: VoucherBase) {
<b class="nc">&nbsp;        trackDetailButtonClicked(trackingParams, &quot;claim&quot;)</b>
<b class="nc">&nbsp;        voucherCoinSlice.claimVoucherCoin(</b>
<b class="nc">&nbsp;            voucher.copy(</b>
<b class="nc">&nbsp;                extra = voucher.extra?.copy(</b>
<b class="nc">&nbsp;                    rewardId = initialVoucher?.extra?.rewardId ?: voucher.extra.rewardId,</b>
&nbsp;                )
&nbsp;            ),
&nbsp;            onSuccess = {
<b class="nc">&nbsp;                dispatch(VoucherDetailReducer.Action.SetCollectedVoucher(it))</b>
<b class="nc">&nbsp;                dispatch(VoucherDetailReducer.Action.SetVoucherData(it))</b>
&nbsp;            }
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    private fun onUseNow() {
<b class="nc">&nbsp;        trackDetailButtonClicked(trackingParams, &quot;use_now&quot;)</b>
<b class="nc">&nbsp;        val voucherToUse = if (state.value.collectedVoucher != null) {</b>
<b class="nc">&nbsp;            state.value.collectedVoucher</b>
&nbsp;        } else {
<b class="nc">&nbsp;            state.value.voucherData</b>
&nbsp;        }
<b class="nc">&nbsp;        navigator.dismiss(</b>
<b class="nc">&nbsp;            ModelConvertUtils.encodeToJson(</b>
<b class="nc">&nbsp;                serializer(), VoucherDetailBackParams(</b>
<b class="nc">&nbsp;                    itemSelected = voucherToUse?.toVoucherDTO(selected = true),</b>
<b class="nc">&nbsp;                    collectedVoucher = voucherToUse?.toVoucherDTO(),</b>
<b class="nc">&nbsp;                    shouldClosePrevScreen = params.shouldClosePrevScreen,</b>
<b class="nc">&nbsp;                    shouldClearSelectedVouchers = params.shouldClearSelectedVouchers,</b>
&nbsp;                )
<b class="nc">&nbsp;            )?.jsonObject</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    private fun onUseLater() {
<b class="nc">&nbsp;        trackDetailButtonClicked(trackingParams, &quot;use_later&quot;)</b>
<b class="nc">&nbsp;        navigator.dismiss(</b>
<b class="nc">&nbsp;            ModelConvertUtils.encodeToJson(</b>
<b class="nc">&nbsp;                serializer(), VoucherDetailBackParams(</b>
<b class="nc">&nbsp;                    isRemoveVoucher = true,</b>
&nbsp;                )
<b class="nc">&nbsp;            )?.jsonObject</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    fun screenGoBack() {
<b class="nc">&nbsp;        trackDetailBackButtonClicked(trackingParams)</b>
<b class="nc">&nbsp;        if (state.value.collectedVoucher != null) {</b>
<b class="nc">&nbsp;            navigator.dismiss(</b>
<b class="nc">&nbsp;                ModelConvertUtils.encodeToJson(</b>
<b class="nc">&nbsp;                    serializer(), VoucherDetailBackParams(</b>
<b class="nc">&nbsp;                        collectedVoucher = state.value.collectedVoucher?.toVoucherDTO(),</b>
&nbsp;                    )
<b class="nc">&nbsp;                )?.jsonObject</b>
&nbsp;            )
&nbsp;        } else {
<b class="nc">&nbsp;            navigator.dismiss()</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-07-08 11:34</div>
</div>
</body>
</html>
