


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>MoMoCompose Coverage Report > TransactionResultRevampVM</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope: MoMoCompose<span class="separator">|</span>    <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">vn.momo.compose.payment.payx.presentation.viewModel</a>
</div>

<h1>Coverage Summary for Class: TransactionResultRevampVM (vn.momo.compose.payment.payx.presentation.viewModel)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">TransactionResultRevampVM</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/56)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/367)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/412)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0.1%
  </span>
  <span class="absValue">
    (4/3027)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TransactionResultRevampVM$buildCommonTextRows$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$buildFailedTextRows$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$buildGamificationTextRows$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$buildSuccessTextRows$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$checkABTestNextBestActionUI$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$getGamificationData$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/220)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$getNextBestActionData$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/83)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$handleOtherAddonsRender$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$handleTRStatusEffects$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$observerMqttDisableTID$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/32)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$observeTicketConfig$1$observer$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/30)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$observeTicketConfig$1$observer$2$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/32)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/30)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/328)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$onPressShareButton$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/41)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$onPressShareButton$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$onPressShareButton$1$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$special$$inlined$inject$default$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$updateTicketList$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/50)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/464)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$updateTicketListWithFinalStatusCheck$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$updateTransactionStatus$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TransactionResultRevampVM$WhenMappings</td>
    <td class="coverageStat"/>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/83)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/459)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/552)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0.1%
  </span>
  <span class="absValue">
    (4/4366)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package vn.momo.compose.payment.payx.presentation.viewModel
&nbsp;
&nbsp;import dev.icerock.moko.mvvm.viewmodel.ViewModel
&nbsp;import kotlinx.coroutines.CoroutineScope
&nbsp;import kotlinx.coroutines.Dispatchers
&nbsp;import kotlinx.coroutines.IO
&nbsp;import kotlinx.coroutines.Job
&nbsp;import kotlinx.coroutines.delay
&nbsp;import kotlinx.coroutines.flow.catch
&nbsp;import kotlinx.coroutines.flow.launchIn
&nbsp;import kotlinx.coroutines.flow.onEach
&nbsp;import kotlinx.coroutines.launch
&nbsp;import kotlinx.serialization.builtins.serializer
&nbsp;import kotlinx.serialization.json.buildJsonObject
&nbsp;import kotlinx.serialization.json.put
&nbsp;import org.jetbrains.compose.resources.getString
&nbsp;import org.koin.core.parameter.parametersOf
&nbsp;import org.koin.core.scope.Scope
&nbsp;import vn.momo.compose.payment.base.core.composeApi.ILogger
&nbsp;import vn.momo.compose.payment.base.core.composeApi.INavigator
&nbsp;import vn.momo.compose.payment.base.core.composeApi.firebaseEvent.IFirebaseTracer
&nbsp;import vn.momo.compose.payment.base.core.composeApi.grafana.IGrafanaTracer
&nbsp;import vn.momo.compose.payment.base.core.composeApi.grafana.model.TraceParameter
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.TrackingErrorCode
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.grafana.GrafanaMetric
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.grafana.PayXApiPerformanceEvent
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.grafana.TRUserEvent
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.FeatureTransResult
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.HomeHeaderButtonClick
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.InfoTransactionResultButtonClick
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.NextBestActionButtonClick
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.ShareCaptureButtonClick
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.TransactionResultRevampScreenDisplayed
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.TransactionResultRevampScreenInteracted
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.TransactionResultRevampScreenUpdated
&nbsp;import vn.momo.compose.payment.base.di.TransactionResultKoinScope
&nbsp;import vn.momo.compose.payment.base.presentation.viewModel.ITransactionResultVM
&nbsp;import vn.momo.compose.payment.base.presentation.viewModel.state.PState
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.ActionButton
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.GamificationResultData
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.NextBestActionItem
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.REVAMP_VERSION
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.REVAMP_VERSION_FLOW
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.RevampButtonAction
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TRSofPrefixErrorCode
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TextRowAction
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TextRowItem
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TransactionItem
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TransactionResultActionButton
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TransactionResultParams
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TransactionResultTicketRevampConfig
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TransactionResultWidget
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TransactionStatus
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TransactionTicketItem
&nbsp;import vn.momo.compose.payment.payx.domain.entities.transactionresult.TxnResponse
&nbsp;import vn.momo.compose.payment.payx.domain.repositories.transactionresult.IGamificationRepository
&nbsp;import vn.momo.compose.payment.payx.domain.repositories.transactionresult.INextBestActionRepository
&nbsp;import vn.momo.compose.payment.payx.domain.repositories.transactionresult.ITransactionResultRepository
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.common.ABTestUseCase
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.common.ScreenshotUseCase
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.common.ShareUseCase
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.transactionresult.GetTicketListUseCase
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.transactionresult.HandleCallbackUrlUseCase
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.transactionresult.ObserverMQTTSyncTIDUseCase
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.transactionresult.ObserverPaymentConfirmFinishedEventsUseCase
&nbsp;import vn.momo.compose.payment.payx.domain.useCases.transactionresult.ObserverTransactionTicketConfigUseCase
&nbsp;import vn.momo.compose.payment.payx.presentation.mixin.CommonMixin
&nbsp;import vn.momo.compose.payment.payx.presentation.mixin.ResultXWidgetMixin
&nbsp;import vn.momo.compose.payment.payx.presentation.model.TransactionInfoBottomSheetProps
&nbsp;import vn.momo.compose.payment.payx.presentation.utils.extension.toFormattedDateString
&nbsp;import vn.momo.compose.payment.payx.presentation.view.assets.Images
&nbsp;import vn.momo.compose.payment.payx.presentation.viewModel.action.TransactionResultAction
&nbsp;import vn.momo.compose.payment.payx.presentation.viewModel.reducers.TransactionResultStatusReducer
&nbsp;import vn.momo.compose.payment.payx.presentation.viewModel.slices.TransactionResultStatusSlice
&nbsp;import vn.momo.compose.payment.payx.presentation.viewModel.state.TransactionResultRevampState
&nbsp;import vn.momo.compose.payment.payx.utils.constant.ABTestNamespace
&nbsp;import vn.momo.compose.payment.payx.utils.constant.ABTestTagname
&nbsp;import vn.momo.compose.resources.Res
&nbsp;import vn.momo.compose.resources.coinRewards
&nbsp;import vn.momo.compose.resources.serviceMerchant
&nbsp;import vn.momo.compose.resources.transactionDetail
&nbsp;import vn.momo.compose.resources.transactionTime
&nbsp;import vn.momo.compose.resources.viewMore
&nbsp;import vn.momo.compose.utils.datamapping.ModelConvertUtils
&nbsp;import vn.momo.compose.utils.datamapping.emptyJsonObject
&nbsp;import vn.momo.compose.utils.datamapping.toJsonObject
&nbsp;import vn.momo.compose.utils.throttle
&nbsp;import vn.momo.core.di.Providers
&nbsp;import vn.momo.core.di.providesSofManagerApi
&nbsp;import vn.momo.kits.const.Colors
&nbsp;import vn.momo.koin.KoinHelper.getInjected
&nbsp;
&nbsp;/**
&nbsp; * Disable TID if:
&nbsp; * 1. response.extra.DISABLE_GET_TRAN_HIS
&nbsp; * 2. TID has 13 characters (virtual TID)
&nbsp; * 3. tranHisMsg.disableTid
&nbsp; */
&nbsp;
&nbsp;class TransactionResultRevampVM(
<b class="nc">&nbsp;    private val koinScope: Scope,</b>
<b class="nc">&nbsp;    override val navigator: INavigator,</b>
<b class="nc">&nbsp;    override val logger: ILogger,</b>
<b class="nc">&nbsp;    private val transactionResultRepository: ITransactionResultRepository,</b>
<b class="nc">&nbsp;    private val gamificationRepository: IGamificationRepository,</b>
<b class="nc">&nbsp;    private val nbaRepository: INextBestActionRepository,</b>
<b class="nc">&nbsp;    private val getTicketListUseCase: GetTicketListUseCase,</b>
<b class="nc">&nbsp;    private val observerMQTTSyncTIDUseCase: ObserverMQTTSyncTIDUseCase,</b>
<b class="nc">&nbsp;    private val observerPaymentConfirmFinishedEventsUseCase: ObserverPaymentConfirmFinishedEventsUseCase,</b>
<b class="nc">&nbsp;    private val observerTransactionTicketConfigUseCase: ObserverTransactionTicketConfigUseCase,</b>
<b class="nc">&nbsp;    private val shareUseCase: ShareUseCase,</b>
<b class="nc">&nbsp;    private val screenshotUseCase: ScreenshotUseCase,</b>
<b class="nc">&nbsp;    private val handleCallbackUrlUseCase: HandleCallbackUrlUseCase,</b>
<b class="nc">&nbsp;    private val abTestUseCase: ABTestUseCase,</b>
<b class="nc">&nbsp;) : ViewModel(), ITransactionResultVM&lt;TransactionResultAction&gt;, CommonMixin, ResultXWidgetMixin {</b>
<b class="nc">&nbsp;    override val logName: String = &quot;[TR]_TransactionResultRevampVM&quot;</b>
<b class="nc">&nbsp;    override val widgetEvents: Map&lt;TransactionResultWidget, GrafanaMetric&gt; = mapOf(</b>
<b class="nc">&nbsp;        TransactionResultWidget.Service to TRUserEvent.TRServiceWidget.event,</b>
<b class="nc">&nbsp;        TransactionResultWidget.Expense to TRUserEvent.TRExpenseWidget.event,</b>
<b class="nc">&nbsp;        TransactionResultWidget.Cornerstone0 to TRUserEvent.TRCornerstone0Widget.event,</b>
<b class="nc">&nbsp;        TransactionResultWidget.Cornerstone1 to TRUserEvent.TRCornerstone1Widget.event</b>
&nbsp;    )
&nbsp;
<b class="nc">&nbsp;    val state = PState(viewModelScope, TransactionResultRevampState())</b>
<b class="nc">&nbsp;    private val trStatusSlice by koinScope.inject&lt;TransactionResultStatusSlice&gt; {</b>
<b class="nc">&nbsp;        parametersOf(</b>
<b class="nc">&nbsp;            viewModelScope</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    private lateinit var jobObserveMqttForEnableTID: Job
&nbsp;    private var delayTicketListJob: Job? = null
&nbsp;    private var delayAddonsJob: Job? = null
<b class="nc">&nbsp;    private val listenerWidgetConfigs: MutableList&lt;Job&gt; = mutableListOf()</b>
&nbsp;    private var isTrackingDone = false
<b class="nc">&nbsp;    override var params: TransactionResultParams = TransactionResultParams()</b>
<b class="nc">&nbsp;    private val disableIDColor = Colors.black_12</b>
<b class="nc">&nbsp;    private val virtualIDColor = Colors.pink_03</b>
<b class="nc">&nbsp;    private val coinColor = Colors.orange_05</b>
<b class="nc">&nbsp;    private val maxCustomExtraInfoCount = 5</b>
<b class="nc">&nbsp;    private val sofSdk by lazy { Providers.providesSofManagerApi() }</b>
&nbsp;
&nbsp;    // TraceMixin variables
<b class="nc">&nbsp;    override val grafana: IGrafanaTracer = getInjected&lt;IGrafanaTracer&gt;()</b>
<b class="nc">&nbsp;    override val scope = CoroutineScope(Dispatchers.IO)</b>
<b class="nc">&nbsp;    override val buffer = mutableMapOf&lt;String, String?&gt;()</b>
<b class="nc">&nbsp;    override val jobs = mutableMapOf&lt;String, Job&gt;()</b>
<b class="nc">&nbsp;    override val firebase: IFirebaseTracer = getInjected&lt;IFirebaseTracer&gt;()</b>
<b class="nc">&nbsp;    override var durationBuffer = mutableMapOf&lt;String, Long?&gt;()</b>
<b class="nc">&nbsp;    override var grafanaFlow: String? = &quot;payx&quot;</b>
<b class="nc">&nbsp;    override var firebaseFlow: String? = &quot;PayX&quot;</b>
<b class="nc">&nbsp;    override var firebaseAppId: String? = &quot;vn.momo.payx&quot;</b>
&nbsp;
&nbsp;    override fun initTrackingFlow() {
<b class="nc">&nbsp;        if (this.params.isSingleBillFlow) {</b>
<b class="nc">&nbsp;            grafanaFlow = &quot;sb_payx&quot;</b>
<b class="nc">&nbsp;            firebaseAppId = &quot;vn.momo.singleBillX&quot;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    override fun trackingScreenInteracted(res: TxnResponse?) {
<b class="nc">&nbsp;        if (isTrackingDone) {</b>
&nbsp;            return
&nbsp;        }
<b class="nc">&nbsp;        firebaseTrack(</b>
<b class="nc">&nbsp;            TransactionResultRevampScreenInteracted(</b>
<b class="nc">&nbsp;                billQuantity = res?.momoMsg?.replyMsgs?.size,</b>
<b class="nc">&nbsp;                orderId = res?.momoMsg?.getPurchaseOrder()</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        isTrackingDone = true</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun trackingScreenDisplayed(res: TxnResponse?) {
<b class="nc">&nbsp;        val transactionItem = res?.momoMsg?.replyMsgs?.getOrNull(0)?.tranHisMsg</b>
<b class="nc">&nbsp;        firebaseTrack(</b>
<b class="nc">&nbsp;            TransactionResultRevampScreenDisplayed(</b>
<b class="nc">&nbsp;                status = transactionItem?.transactionStatus?.name,</b>
<b class="nc">&nbsp;                tranId = transactionItem?.transactionId,</b>
<b class="nc">&nbsp;                errorCode = transactionItem?.error,</b>
<b class="nc">&nbsp;                errorDesc = transactionItem?.desc,</b>
<b class="nc">&nbsp;                orderId = res?.momoMsg?.getPurchaseOrder(),</b>
<b class="nc">&nbsp;                service = transactionItem?.serviceId,</b>
<b class="nc">&nbsp;                billQuantity = res?.momoMsg?.replyMsgs?.size</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        firebaseTrack(</b>
<b class="nc">&nbsp;            FeatureTransResult(</b>
<b class="nc">&nbsp;                service = transactionItem?.serviceId</b>
&nbsp;            )
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    override fun onCreate(params: Map&lt;String, Any?&gt;) {
<b class="nc">&nbsp;        logInfo(&quot;onCreate-params&quot;, params)</b>
<b class="nc">&nbsp;        this.params = transactionResultRepository.formatParams(params)</b>
<b class="nc">&nbsp;        val response = getInitialTnxResponse()</b>
<b class="nc">&nbsp;        logInfo(&quot;onCreate-response&quot;, response)</b>
&nbsp;        // tracking
<b class="nc">&nbsp;        grafanaCount(TRUserEvent.DisplayPaymentResultCount.event)</b>
<b class="nc">&nbsp;        grafanaStopTraceIdsParams()</b>
<b class="nc">&nbsp;        grafanaStart(TRUserEvent.TRRevampInteracted.event)</b>
<b class="nc">&nbsp;        grafanaStart(TRUserEvent.PaymentStatus.event)</b>
<b class="nc">&nbsp;        grafanaStart(TRUserEvent.PaymentStatusDuration.event)</b>
<b class="nc">&nbsp;        startGrafanaTraceWidget()</b>
<b class="nc">&nbsp;        trackingScreenDisplayed(response)</b>
&nbsp;        // handle init
<b class="nc">&nbsp;        handleInitialStatus(response)</b>
<b class="nc">&nbsp;        updateTicketList(response, onResult = { ticketList -&gt;</b>
<b class="nc">&nbsp;            trackingScreenInteracted(response)</b>
<b class="nc">&nbsp;            observeTicketConfig(ticketList)</b>
<b class="nc">&nbsp;            handleOtherAddonsRender(response)</b>
&nbsp;        })
<b class="nc">&nbsp;        updateTransactionStatus()</b>
<b class="nc">&nbsp;        observerMqttUpdateStatus()</b>
<b class="nc">&nbsp;        observerMqttDisableTID()</b>
<b class="nc">&nbsp;        checkABTestNextBestActionUI()</b>
<b class="nc">&nbsp;        handleTRStatusEffects()</b>
<b class="nc">&nbsp;        grafanaSuccess(TRUserEvent.TRRevampInteracted.event)</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun onCleared() {
<b class="nc">&nbsp;        if (::jobObserveMqttForEnableTID.isInitialized) jobObserveMqttForEnableTID.cancel()</b>
<b class="nc">&nbsp;        delayTicketListJob?.cancel()</b>
<b class="nc">&nbsp;        delayAddonsJob?.cancel()</b>
&nbsp;
<b class="nc">&nbsp;        listenerWidgetConfigs.forEach {</b>
<b class="nc">&nbsp;            it.cancel()</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        state.reset()</b>
<b class="nc">&nbsp;        grafanaFail(</b>
<b class="nc">&nbsp;            TRUserEvent.PaymentStatus.event,</b>
<b class="nc">&nbsp;            TraceParameter(errorCode = TrackingErrorCode.UserExit.code.toDouble())</b>
&nbsp;        )
<b class="nc">&nbsp;        TransactionResultKoinScope.end(koinScope.id)</b>
<b class="nc">&nbsp;        super.onCleared()</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun dispatch(action: TransactionResultAction) {
<b class="nc">&nbsp;        when (action) {</b>
<b class="nc">&nbsp;            TransactionResultAction.GoHome -&gt; {</b>
<b class="nc">&nbsp;                goHome()</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OpenTransactionDetailScreen -&gt; {</b>
<b class="nc">&nbsp;                openTransactionDetailScreen(</b>
<b class="nc">&nbsp;                    action.transactionItem</b>
&nbsp;                )
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnWidgetLoadSuccess -&gt; {</b>
<b class="nc">&nbsp;                onWidgetLoadSuccess(action.widget, state.value.ticketList.getOrNull(0)?.transaction)</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnWidgetLoadFailed -&gt; {</b>
<b class="nc">&nbsp;                onWidgetLoadFailed(action.widget)</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnWidgetLayoutChanged -&gt; {</b>
<b class="nc">&nbsp;                onWidgetLayoutChanged(</b>
<b class="nc">&nbsp;                    action.widget,</b>
<b class="nc">&nbsp;                    action.width,</b>
<b class="nc">&nbsp;                    action.height,</b>
<b class="nc">&nbsp;                    state.value.ticketList.getOrNull(0)?.transaction</b>
&nbsp;                )
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.GetGamificationData -&gt; {</b>
<b class="nc">&nbsp;                getGamificationData(action.requestId)</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.GetNextBestActionData -&gt; {</b>
<b class="nc">&nbsp;                getNextBestActionData(action.serviceId)</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnPressGamificationCard -&gt; onPressGamificationCard(</b>
<b class="nc">&nbsp;                action.data,</b>
&nbsp;            )
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnPressShare -&gt; onPressShareButton(action.transactionItem)</b>
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnPressBestAction -&gt; {</b>
<b class="nc">&nbsp;                onPressBestAction(action.actionItem)</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnPressTextRow -&gt; {</b>
<b class="nc">&nbsp;                onPresTextRow(</b>
<b class="nc">&nbsp;                    action.textRowItem,</b>
<b class="nc">&nbsp;                    action.transactionItem,</b>
<b class="nc">&nbsp;                    action.ticketIndex,</b>
<b class="nc">&nbsp;                    action.disableDetailMode</b>
&nbsp;                )
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            is TransactionResultAction.OnPressRevampButtonAction -&gt; {</b>
<b class="nc">&nbsp;                onPressRevampButtonAction(action.button)</b>
&nbsp;            }
&nbsp;
&nbsp;            else -&gt; {}
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    override fun handleTRStatusEffects() {
<b class="nc">&nbsp;        trStatusSlice.effect.onEach {</b>
<b class="nc">&nbsp;            when (it) {</b>
<b class="nc">&nbsp;                is TransactionResultStatusReducer.TransactionResultStatusEffect.OnGetTransactionResultStatusAPIEmitted -&gt; onGetTransactionStatusEmitted(</b>
<b class="nc">&nbsp;                    it.txnResponse</b>
&nbsp;                )
&nbsp;
<b class="nc">&nbsp;                is TransactionResultStatusReducer.TransactionResultStatusEffect.OnObserverTransactionStatusMQTTEmitted -&gt; onObserverMqttUpdateStatusEmitted(</b>
<b class="nc">&nbsp;                    it.txnResponse</b>
&nbsp;                )
&nbsp;
&nbsp;                else -&gt; {}
&nbsp;            }
<b class="nc">&nbsp;        }.launchIn(viewModelScope)</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    override fun getInitialTnxResponse(): TxnResponse? = when {</b>
<b class="nc">&nbsp;        params.isSingleBillFlow -&gt; transactionResultRepository.getSingleBillTxnResponse(params)</b>
<b class="nc">&nbsp;        params.isDeeplinkFlow -&gt; transactionResultRepository.getDeepLinkTxnResponse(params)</b>
<b class="nc">&nbsp;        else -&gt; params.response</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun handleInitialStatus(res: TxnResponse?) {
<b class="nc">&nbsp;        res?.momoMsg?.let {</b>
<b class="nc">&nbsp;            val isFinal = !it.hasPendingStatus</b>
<b class="nc">&nbsp;            if (isFinal) {</b>
<b class="nc">&nbsp;                logInfo(&quot;requestSyncSof&quot;, &quot;&quot;)</b>
<b class="nc">&nbsp;                sofSdk.requestSync(&quot;vn.momo.payx&quot;).launchIn(scope)</b>
&nbsp;            }
<b class="nc">&nbsp;            grafanaCount(</b>
<b class="nc">&nbsp;                GrafanaMetric(</b>
<b class="nc">&nbsp;                    flow = grafanaFlow ?: &quot;payx&quot;,</b>
<b class="nc">&nbsp;                    step = &quot;init_payment_status_${if (this.params.isSingleBillFlow) it.statusLabelSB else it.statusLabel}&quot;</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun updateTicketList(
&nbsp;        res: TxnResponse?, onResult: ((List&lt;TransactionTicketItem&gt;) -&gt; Unit)?
&nbsp;    ) {
<b class="nc">&nbsp;        val callbackUrl = res?.momoMsg?.callbackUrl</b>
<b class="nc">&nbsp;        logInfo(&quot;handleCallbackUrlUseCase&quot;, &quot;$callbackUrl&quot;)</b>
<b class="nc">&nbsp;        if (!callbackUrl.isNullOrEmpty()) {</b>
<b class="nc">&nbsp;            handleCallbackUrlUseCase(callbackUrl)</b>
<b class="nc">&nbsp;            onResult?.invoke(getDefaultTicketList())</b>
&nbsp;            return
&nbsp;        }
<b class="nc">&nbsp;        res?.momoMsg?.replyMsgs?.let {</b>
<b class="nc">&nbsp;            viewModelScope.launch {</b>
<b class="nc">&nbsp;                val ticketList = getTicketListUseCase(</b>
<b class="nc">&nbsp;                    res, params.miniAppWidgetId, REVAMP_VERSION_FLOW, REVAMP_VERSION</b>
<b class="nc">&nbsp;                ).ifEmpty {</b>
<b class="nc">&nbsp;                    logInfo(</b>
<b class="nc">&nbsp;                        &quot;getTicketListUseCase-EMPTY&quot;, &quot;miniAppWidgetId-${params.miniAppWidgetId}&quot;</b>
&nbsp;                    )
<b class="nc">&nbsp;                    onResult?.invoke(getDefaultTicketList())</b>
<b class="nc">&nbsp;                    return@launch</b>
&nbsp;                }
<b class="nc">&nbsp;                val fees = transactionResultRepository.getFees(res)</b>
<b class="nc">&nbsp;                logInfo(&quot;updateTicketList&quot;, ticketList)</b>
<b class="nc">&nbsp;                logInfo(&quot;updateTicketList&quot;, fees)</b>
&nbsp;
<b class="nc">&nbsp;                val updatedTicketList =</b>
<b class="nc">&nbsp;                    state.value.ticketList.ifEmpty { ticketList }.mapIndexed { index, ticket -&gt;</b>
<b class="nc">&nbsp;                        val updatedTicket = ticketList.getOrNull(index) ?: ticket</b>
<b class="nc">&nbsp;                        val statusChange =</b>
<b class="nc">&nbsp;                            ticket.transaction?.status != updatedTicket.transaction?.status</b>
&nbsp;
<b class="nc">&nbsp;                        val textRows = buildTextRows(</b>
<b class="nc">&nbsp;                            transactionItem = updatedTicket.transaction ?: TransactionItem(),</b>
<b class="nc">&nbsp;                            extraInfo = updatedTicket.extraInfo,</b>
<b class="nc">&nbsp;                            disableDetailMode = updatedTicket.disableDetailMode</b>
&nbsp;                        )
&nbsp;
<b class="nc">&nbsp;                        ticket.copy(</b>
<b class="nc">&nbsp;                            transaction = updatedTicket.transaction,</b>
<b class="nc">&nbsp;                            widget = updatedTicket.widget,</b>
<b class="nc">&nbsp;                            serviceName = updatedTicket.serviceName,</b>
<b class="nc">&nbsp;                            extraInfo = updatedTicket.extraInfo,</b>
<b class="nc">&nbsp;                            messageInfo = if (statusChange) updatedTicket.messageInfo else ticket.messageInfo,</b>
<b class="nc">&nbsp;                            primaryActionButton = if (statusChange) TransactionResultActionButton() else ticket.primaryActionButton,</b>
<b class="nc">&nbsp;                            secondaryActionButton = if (statusChange) TransactionResultActionButton() else ticket.secondaryActionButton,</b>
<b class="nc">&nbsp;                            disableDetailMode = updatedTicket.disableDetailMode,</b>
<b class="nc">&nbsp;                            textRows = textRows</b>
<b class="nc">&nbsp;                        )</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                state.update { currentState -&gt;</b>
<b class="nc">&nbsp;                    currentState.copy(</b>
<b class="nc">&nbsp;                        ticketList = updatedTicketList,</b>
<b class="nc">&nbsp;                        fees = fees,</b>
<b class="nc">&nbsp;                        disableTID = res.extra?.isDisableGetTranHis ?: false</b>
&nbsp;                    )
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                ticketList.takeIf { it.isNotEmpty() }?.let { bills -&gt;</b>
<b class="nc">&nbsp;                    val allFinal = bills.all { !it.widget.params.tranHisMsg.isPending }</b>
<b class="nc">&nbsp;                    if (allFinal) {</b>
<b class="nc">&nbsp;                        val first = bills.firstOrNull()</b>
<b class="nc">&nbsp;                        grafanaSuccess(</b>
<b class="nc">&nbsp;                            TRUserEvent.PaymentStatusDuration.event, TraceParameter(</b>
<b class="nc">&nbsp;                                errorCode = TRSofPrefixErrorCode.gen(first?.transaction?.moneySource),</b>
<b class="nc">&nbsp;                                serviceCode = first?.transaction?.serviceId</b>
&nbsp;                            )
&nbsp;                        )
<b class="nc">&nbsp;                        grafanaStop(</b>
<b class="nc">&nbsp;                            TRUserEvent.PaymentStatus.event,</b>
<b class="nc">&nbsp;                            bills.all { !it.widget.params.tranHisMsg.isSuccess },</b>
<b class="nc">&nbsp;                            TraceParameter()</b>
&nbsp;                        )
<b class="nc">&nbsp;                        trStatusSlice.clearAPIJob()</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                onResult?.invoke(ticketList)</b>
&nbsp;            }
&nbsp;            return
&nbsp;        }
<b class="nc">&nbsp;        onResult?.invoke(getDefaultTicketList())</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun updateTransactionStatus() {
<b class="nc">&nbsp;        val isSkipLoading = this.params.response?.momoMsg?.skipLoading ?: false</b>
<b class="nc">&nbsp;        val hasPendingStatus = this.params.response?.momoMsg?.hasPendingStatus ?: true</b>
<b class="nc">&nbsp;        when {</b>
<b class="nc">&nbsp;            hasPendingStatus &amp;&amp; isSkipLoading -&gt; {</b>
<b class="nc">&nbsp;                logInfo(</b>
<b class="nc">&nbsp;                    &quot;updateTransactionStatus&quot;, &quot;hasPendingStatus&amp;&amp;isSkipLoading&quot;, true</b>
&nbsp;                )
<b class="nc">&nbsp;                observerPaymentConfirmFinishedEventsUseCase().onEach {</b>
<b class="nc">&nbsp;                    logInfo(&quot;updateTransactionStatus-PaymentConfirmFinished&quot;, it)</b>
<b class="nc">&nbsp;                    if (it) {</b>
<b class="nc">&nbsp;                        getTransactionStatus()</b>
&nbsp;                    }
<b class="nc">&nbsp;                }.launchIn(viewModelScope)</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            hasPendingStatus -&gt; {</b>
<b class="nc">&nbsp;                getTransactionStatus()</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    override fun getTransactionStatus() {
<b class="nc">&nbsp;        grafanaStart(PayXApiPerformanceEvent.TransactionResultStatusAPI.event)</b>
<b class="nc">&nbsp;        logInfo(&quot;getTransactionStatus&quot;, this.params.response?.momoMsg?.getPurchaseOrder())</b>
<b class="nc">&nbsp;        trStatusSlice.getTransactionResultStatusAPI(</b>
<b class="nc">&nbsp;            getPurchaseOrder(),</b>
<b class="nc">&nbsp;            getPurchaseType(),</b>
<b class="nc">&nbsp;            this.params.retryStatusConfig?.maxRetry,</b>
<b class="nc">&nbsp;            this.params.retryStatusConfig?.retryTimeout,</b>
<b class="nc">&nbsp;            this.params.apiGetStatus?.subDomain</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    override fun onGetTransactionStatusEmitted(res: TxnResponse) {
<b class="nc">&nbsp;        res.momoMsg?.let {</b>
<b class="nc">&nbsp;            this.params.response = res</b>
<b class="nc">&nbsp;            logInfo(&quot;getTransactionStatus-response&quot;, res)</b>
<b class="nc">&nbsp;            updateTicketListWithFinalStatusCheck(res)</b>
<b class="nc">&nbsp;            grafanaCount(</b>
<b class="nc">&nbsp;                GrafanaMetric(</b>
<b class="nc">&nbsp;                    flow = grafanaFlow ?: &quot;payx&quot;, step = &quot;api_payment_status_${it.statusLabel}&quot;</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;            firebaseTrack(</b>
<b class="nc">&nbsp;                TransactionResultRevampScreenUpdated(</b>
<b class="nc">&nbsp;                    status = it.replyMsgs?.getOrNull(0)?.tranHisMsg?.transactionStatus?.name,</b>
<b class="nc">&nbsp;                    source = &quot;api&quot;,</b>
<b class="nc">&nbsp;                    orderId = it.getPurchaseOrder(),</b>
<b class="nc">&nbsp;                    final = if (it.isFinalStatus) 1 else 0,</b>
<b class="nc">&nbsp;                    errorCode = it.replyMsgs?.getOrNull(0)?.tranHisMsg?.error,</b>
<b class="nc">&nbsp;                    billQuantity = it.replyMsgs?.size</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;            if (it.isFinalStatus) {</b>
<b class="nc">&nbsp;                grafanaSuccess(</b>
<b class="nc">&nbsp;                    PayXApiPerformanceEvent.TransactionResultStatusAPI.event,</b>
<b class="nc">&nbsp;                    TraceParameter(errorCode = it.replyMsgs?.getOrNull(0)?.tranHisMsg?.error?.toDouble())</b>
&nbsp;                )
&nbsp;            }
<b class="nc">&nbsp;            logInfo(&quot;[API] onGetTransactionStatusEmitted status - ${it.statusLabel}&quot;, it, true)</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun observerMqttUpdateStatus() {
<b class="nc">&nbsp;        grafanaStart(PayXApiPerformanceEvent.TransactionResultStatusMQTT.event)</b>
<b class="nc">&nbsp;        trStatusSlice.observerTransactionStatusMQTT(getPurchaseOrder())</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun onObserverMqttUpdateStatusEmitted(res: TxnResponse?) {
<b class="nc">&nbsp;        res?.momoMsg?.let {</b>
<b class="nc">&nbsp;            grafanaCount(</b>
<b class="nc">&nbsp;                GrafanaMetric(</b>
<b class="nc">&nbsp;                    flow = grafanaFlow ?: &quot;payx&quot;, step = &quot;mqtt_payment_status_${it.statusLabel}&quot;</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;            firebaseTrack(</b>
<b class="nc">&nbsp;                TransactionResultRevampScreenUpdated(</b>
<b class="nc">&nbsp;                    status = it.replyMsgs?.getOrNull(0)?.tranHisMsg?.transactionStatus?.name,</b>
<b class="nc">&nbsp;                    source = &quot;mqtt&quot;,</b>
<b class="nc">&nbsp;                    orderId = it.getPurchaseOrder(),</b>
<b class="nc">&nbsp;                    final = if (it.isFinalStatus) 1 else 0,</b>
<b class="nc">&nbsp;                    errorCode = it.replyMsgs?.getOrNull(0)?.tranHisMsg?.error,</b>
<b class="nc">&nbsp;                    billQuantity = it.replyMsgs?.size</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;            if (it.isFinalStatus) {</b>
<b class="nc">&nbsp;                grafanaSuccess(</b>
<b class="nc">&nbsp;                    PayXApiPerformanceEvent.TransactionResultStatusMQTT.event,</b>
<b class="nc">&nbsp;                    TraceParameter(errorCode = it.replyMsgs?.getOrNull(0)?.tranHisMsg?.error?.toDouble())</b>
&nbsp;                )
&nbsp;            }
<b class="nc">&nbsp;            logInfo(&quot;[MQTT] onObserverMqttUpdateStatusEmitted status - ${it.statusLabel}&quot;, it)</b>
<b class="nc">&nbsp;            this.params.response = res</b>
<b class="nc">&nbsp;            updateTicketListWithFinalStatusCheck(res)</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun observerMqttDisableTID() {
<b class="nc">&nbsp;        jobObserveMqttForEnableTID =</b>
<b class="nc">&nbsp;            observerMQTTSyncTIDUseCase(getPurchaseOrder()).onEach { status -&gt;</b>
<b class="nc">&nbsp;                logInfo(&quot;observerMqttDisableTID-status&quot;, status)</b>
<b class="nc">&nbsp;                if (status) {</b>
<b class="nc">&nbsp;                    state.update {</b>
<b class="nc">&nbsp;                        it.copy(</b>
<b class="nc">&nbsp;                            disableTID = false</b>
&nbsp;                        )
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }.launchIn(viewModelScope)</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun observeTicketConfig(ticketList: List&lt;TransactionTicketItem&gt;) {
<b class="nc">&nbsp;        ticketList.onEachIndexed { index, ticket -&gt;</b>
<b class="nc">&nbsp;            val observer = observerTransactionTicketConfigUseCase(ticket,</b>
<b class="nc">&nbsp;                serializer = TransactionResultTicketRevampConfig.serializer(),</b>
<b class="nc">&nbsp;                default = { TransactionResultTicketRevampConfig() }).onEach { config -&gt;</b>
<b class="nc">&nbsp;                logInfo(&quot;observeTicketConfig-WidgetConfig&quot;, config)</b>
<b class="nc">&nbsp;                viewModelScope.launch {</b>
<b class="nc">&nbsp;                    val currentTicketList = state.value.ticketList</b>
<b class="nc">&nbsp;                    val currentNextBestActionList = state.value.nextBestActionList</b>
<b class="nc">&nbsp;                    val updatedTicketList = currentTicketList.map { currentTicket -&gt;</b>
<b class="nc">&nbsp;                        val isSpamConfig = deepCompareWidgetConfig(currentTicket, config)</b>
<b class="nc">&nbsp;                        if (ticket.key == currentTicket.key &amp;&amp; !isSpamConfig) {</b>
<b class="nc">&nbsp;                            val textRows = buildTextRows(</b>
<b class="nc">&nbsp;                                transactionItem = currentTicket.transaction?.copy(</b>
<b class="nc">&nbsp;                                    serviceName = config.serviceName ?: currentTicket.serviceName</b>
<b class="nc">&nbsp;                                ) ?: TransactionItem(),</b>
<b class="nc">&nbsp;                                extraInfo = buildExtraInfo(config),</b>
<b class="nc">&nbsp;                                disableDetailMode = config.disableDetailMode,</b>
&nbsp;                            )
&nbsp;
<b class="nc">&nbsp;                            currentTicket.copy(isWidgetLoadDone = true,</b>
<b class="nc">&nbsp;                                extraInfo = buildExtraInfo(config),</b>
<b class="nc">&nbsp;                                serviceName = config.serviceName?.takeIf { str -&gt; str.isNotBlank() }</b>
<b class="nc">&nbsp;                                    ?: currentTicket.serviceName,</b>
<b class="nc">&nbsp;                                revampPrimaryButton = buildActionButton(config.primaryButton),</b>
<b class="nc">&nbsp;                                revampSecondaryButton = buildActionButton(config.secondaryButton),</b>
<b class="nc">&nbsp;                                messageInfo = if (params.isSingleBillFlow) config.message?.takeIf { str -&gt; str.isNotBlank() }</b>
<b class="nc">&nbsp;                                    ?: currentTicket.messageInfo else currentTicket.messageInfo, // ACS-2658 Off service config desc</b>
<b class="nc">&nbsp;                                textRows = textRows)</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            currentTicket</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;
&nbsp;                    // Rules: NextBestAction is only applied for firstTransaction
<b class="nc">&nbsp;                    val updatedNextBestActionList = if (index == 0) config.nextBestAction ?: emptyList() else currentNextBestActionList</b>
<b class="nc">&nbsp;                    val isTicketListChanged = updatedTicketList != currentTicketList</b>
<b class="nc">&nbsp;                    val isNextBestActionChanged = updatedNextBestActionList != currentNextBestActionList</b>
&nbsp;
<b class="nc">&nbsp;                    if (isTicketListChanged || isNextBestActionChanged) {</b>
<b class="nc">&nbsp;                        state.update {</b>
<b class="nc">&nbsp;                            it.copy(</b>
<b class="nc">&nbsp;                                ticketList = updatedTicketList,</b>
<b class="nc">&nbsp;                                nextBestActionList = updatedNextBestActionList</b>
&nbsp;                            )
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            listenerWidgetConfigs.add(observer.launchIn(viewModelScope))</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun goHome() {
<b class="nc">&nbsp;        logInfo(&quot;goHome&quot;, &quot;&quot;)</b>
<b class="nc">&nbsp;        firebaseTrack(</b>
<b class="nc">&nbsp;            HomeHeaderButtonClick(</b>
<b class="nc">&nbsp;                serviceId = state.value.ticketList.getOrNull(0)?.transaction?.serviceId</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        navigator.goHome()</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun openTransactionDetailScreen(transactionItem: TransactionItem) {
<b class="nc">&nbsp;        val params = buildJsonObject {</b>
<b class="nc">&nbsp;            put(&quot;tranId&quot;, transactionItem.transactionId)</b>
<b class="nc">&nbsp;            put(&quot;serviceId&quot;, transactionItem.serviceId ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        logInfo(&quot;openTransactionDetailScreen&quot;, params)</b>
<b class="nc">&nbsp;        navigator.navigateFeatureCode(</b>
<b class="nc">&nbsp;            &quot;transaction_history_detail&quot;, params, String.serializer()</b>
<b class="nc">&nbsp;        ).launchIn(viewModelScope)</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun getGamificationData(requestId: String) {
<b class="nc">&nbsp;        viewModelScope.launch {</b>
<b class="nc">&nbsp;            val gamificationData = gamificationRepository.getGamificationData(requestId,</b>
<b class="nc">&nbsp;                5,</b>
<b class="nc">&nbsp;                traceStart = { grafanaStart(PayXApiPerformanceEvent.TRGamification.event) },</b>
<b class="nc">&nbsp;                traceSuccess = { grafanaSuccess(PayXApiPerformanceEvent.TRGamification.event) },</b>
<b class="nc">&nbsp;                traceFail = { grafanaFail(PayXApiPerformanceEvent.TRGamification.event) })</b>
<b class="nc">&nbsp;            val transactionDetailKey = getString(Res.string.transactionDetail)</b>
<b class="nc">&nbsp;            val gamificationRows = buildGamificationTextRows(gamificationData.coinReward)</b>
<b class="nc">&nbsp;            val showGamificationRows = gamificationData.hasCoinReward</b>
&nbsp;
<b class="nc">&nbsp;            logInfo(&quot;getGamificationData&quot;, gamificationData)</b>
&nbsp;
<b class="nc">&nbsp;            state.update { state -&gt;</b>
<b class="nc">&nbsp;                if (showGamificationRows) {</b>
<b class="nc">&nbsp;                    state.copy(gamificationData = gamificationData,</b>
<b class="nc">&nbsp;                        ticketList = state.ticketList.mapIndexed { index, ticket -&gt;</b>
<b class="nc">&nbsp;                        if (index != 0 || ticket.textRows.isNullOrEmpty()) return@mapIndexed ticket</b>
&nbsp;
<b class="nc">&nbsp;                        val rows = ticket.textRows.toMutableList()</b>
<b class="nc">&nbsp;                        rows.indexOfFirst { it.key == transactionDetailKey }.takeIf { it &gt;= 0 }</b>
<b class="nc">&nbsp;                            ?.let { rows.addAll(it, gamificationRows) }</b>
&nbsp;
<b class="nc">&nbsp;                        ticket.copy(textRows = rows)</b>
&nbsp;                    })
&nbsp;                } else {
<b class="nc">&nbsp;                    state.copy(gamificationData = gamificationData)</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    override fun onPressGamificationCard(
&nbsp;        data: GamificationResultData?,
&nbsp;    ) {
<b class="nc">&nbsp;        firebaseTrack(</b>
<b class="nc">&nbsp;            NextBestActionButtonClick(</b>
<b class="nc">&nbsp;                serviceId = state.value.ticketList.getOrNull(0)?.transaction?.serviceId,</b>
<b class="nc">&nbsp;                actionType = &quot;game&quot;,</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        logInfo(&quot;onPressGamificationCard&quot;, data)</b>
<b class="nc">&nbsp;        data?.ctaRefId?.let {</b>
<b class="nc">&nbsp;            val params =</b>
<b class="nc">&nbsp;                ModelConvertUtils.encodeToPureMap(GamificationResultData.serializer(), data)</b>
<b class="nc">&nbsp;                    .toMutableMap()</b>
<b class="nc">&nbsp;            params[&quot;tranHisMsg&quot;] = state.value.ticketList.map { item -&gt;</b>
<b class="nc">&nbsp;                ModelConvertUtils.encodeToPureMap(</b>
<b class="nc">&nbsp;                    TransactionItem.serializer(), item.transaction ?: TransactionItem()</b>
<b class="nc">&nbsp;                )</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            navigator.navigateFeatureCode(it, params.toJsonObject(), String.serializer())</b>
<b class="nc">&nbsp;                .launchIn(viewModelScope)</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun onPressRevampButtonAction(button: RevampButtonAction) {
<b class="nc">&nbsp;        logInfo(&quot;onPressRevampButtonAction&quot;, button)</b>
<b class="nc">&nbsp;        if (button.isValid) {</b>
<b class="nc">&nbsp;            navigator.navigateFeatureCode(</b>
<b class="nc">&nbsp;                button.code!!, button.params ?: emptyJsonObject(), String.serializer()</b>
<b class="nc">&nbsp;            ).launchIn(viewModelScope)</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun onPresTextRow(
&nbsp;        textRowItem: TextRowItem,
<b class="nc">&nbsp;        transactionItem: TransactionItem? = null,</b>
&nbsp;        ticketIndex: Int,
&nbsp;        disableDetailMode: Boolean
&nbsp;    ) {
<b class="nc">&nbsp;        transactionItem?.let {</b>
<b class="nc">&nbsp;            logInfo(&quot;onPresTextRow:textRowItem&quot;, textRowItem)</b>
<b class="nc">&nbsp;            logInfo(&quot;onPresTextRow:transactionItem&quot;, it)</b>
<b class="nc">&nbsp;            logInfo(&quot;onPresTextRow:ticketIndex&quot;, ticketIndex)</b>
<b class="nc">&nbsp;            when (textRowItem.action) {</b>
&nbsp;                TextRowAction.GO_TO_DETAIL -&gt; {
<b class="nc">&nbsp;                    logInfo(&quot;onPresTextRow-isBlockingTid&quot;, buildJsonObject {</b>
<b class="nc">&nbsp;                        put(&quot;disableDetailMode&quot;, &quot;$disableDetailMode&quot;)</b>
<b class="nc">&nbsp;                        put(&quot;isVirtualTID&quot;, &quot;${it.isVirtualTID}&quot;)</b>
<b class="nc">&nbsp;                        put(&quot;disableTid&quot;, &quot;${it.disableTid}&quot;)</b>
<b class="nc">&nbsp;                        put(&quot;state.disableTID&quot;, &quot;${state.value.disableTID}&quot;)</b>
<b class="nc">&nbsp;                    })</b>
<b class="nc">&nbsp;                    if (!isBlockingTid(disableDetailMode, it)) {</b>
<b class="nc">&nbsp;                        openTransactionDetailScreen(</b>
<b class="nc">&nbsp;                            it</b>
&nbsp;                        )
&nbsp;                    } else return
&nbsp;                }
&nbsp;
&nbsp;                TextRowAction.OPEN_BOTTOM_SHEET -&gt; {
<b class="nc">&nbsp;                    openInfoBottomSheet(ticketIndex, it)</b>
&nbsp;                }
&nbsp;
&nbsp;                TextRowAction.GO_TO_COIN -&gt; {
<b class="nc">&nbsp;                    onPressGamificationCard(state.value.gamificationData.coinReward)</b>
&nbsp;                }
&nbsp;
&nbsp;                else -&gt; {} // Do nothing
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private val onPressShareButton = throttle&lt;TransactionItem&gt;(</b>
<b class="nc">&nbsp;        300L, viewModelScope, dispatcher = Dispatchers.IO</b>
&nbsp;    ) { transactionItem -&gt;
<b class="nc">&nbsp;        firebaseTrack(</b>
<b class="nc">&nbsp;            ShareCaptureButtonClick(</b>
<b class="nc">&nbsp;                serviceId = transactionItem.serviceId</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        screenshotUseCase.invoke().onEach {</b>
<b class="nc">&nbsp;            shareUseCase.invoke(it, transactionItem.transactionId)</b>
<b class="nc">&nbsp;        }.catch { e -&gt;</b>
<b class="nc">&nbsp;            logInfo(&quot;onPressShareButton&quot;, e.message, true)</b>
<b class="nc">&nbsp;        }.launchIn(viewModelScope)</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun openInfoBottomSheet(ticketIndex: Int, transactionItem: TransactionItem) {
<b class="nc">&nbsp;        firebaseTrack(</b>
<b class="nc">&nbsp;            InfoTransactionResultButtonClick(</b>
<b class="nc">&nbsp;                serviceId = transactionItem.serviceId</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        navigator.showBottomSheet(buildJsonObject {</b>
<b class="nc">&nbsp;            put(&quot;type&quot;, &quot;transactionInfo&quot;)</b>
<b class="nc">&nbsp;            put(</b>
<b class="nc">&nbsp;                &quot;props&quot;, ModelConvertUtils.encodeToJson(</b>
<b class="nc">&nbsp;                    TransactionInfoBottomSheetProps.serializer(), TransactionInfoBottomSheetProps(</b>
<b class="nc">&nbsp;                        ticketIndex, params</b>
&nbsp;                    )
<b class="nc">&nbsp;                ) ?: emptyJsonObject()</b>
&nbsp;            )
<b class="nc">&nbsp;        }).launchIn(viewModelScope)</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun onPressBestAction(actionItem: NextBestActionItem) {
<b class="nc">&nbsp;        logInfo(&quot;onPressBestAction&quot;, actionItem)</b>
<b class="nc">&nbsp;        if (actionItem.isValid) {</b>
<b class="nc">&nbsp;            firebaseTrack(</b>
<b class="nc">&nbsp;                NextBestActionButtonClick(</b>
<b class="nc">&nbsp;                    actionType = &quot;service&quot;,</b>
<b class="nc">&nbsp;                    serviceId = state.value.ticketList.getOrNull(0)?.transaction?.serviceId,</b>
<b class="nc">&nbsp;                    buttonName = &quot;nba&quot;</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;            navigator.navigateFeatureCode(</b>
<b class="nc">&nbsp;                actionItem.code ?: &quot;&quot;, actionItem.params ?: emptyJsonObject(), String.serializer()</b>
<b class="nc">&nbsp;            ).launchIn(viewModelScope)</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun getNextBestActionData(serviceId: String) {
<b class="nc">&nbsp;        viewModelScope.launch {</b>
<b class="nc">&nbsp;            nbaRepository.getNextBestActionData(serviceId, 1, traceStart = {</b>
<b class="nc">&nbsp;                grafanaStart(PayXApiPerformanceEvent.TRNextBestAction.event)</b>
&nbsp;            }, traceSuccess = {
<b class="nc">&nbsp;                grafanaSuccess(PayXApiPerformanceEvent.TRNextBestAction.event)</b>
&nbsp;            }, traceFail = {
<b class="nc">&nbsp;                grafanaFail(PayXApiPerformanceEvent.TRNextBestAction.event)</b>
<b class="nc">&nbsp;            }).let {</b>
<b class="nc">&nbsp;                logInfo(&quot;getNextBestActionData&quot;, it)</b>
<b class="nc">&nbsp;                state.update { state -&gt;</b>
<b class="nc">&nbsp;                    state.copy(</b>
<b class="nc">&nbsp;                        apiNextBestActionList = it</b>
&nbsp;                    )
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    override fun getDefaultTicketList(): List&lt;TransactionTicketItem&gt; = listOf(</b>
<b class="nc">&nbsp;        TransactionTicketItem(</b>
<b class="nc">&nbsp;            transaction = TransactionItem(</b>
<b class="nc">&nbsp;                tranStatus = 0,</b>
&nbsp;            )
&nbsp;        )
&nbsp;    )
&nbsp;
<b class="nc">&nbsp;    override fun getPurchaseOrder(): String? = this.params.response?.momoMsg?.getPurchaseOrder()</b>
&nbsp;
&nbsp;    override fun getPurchaseType(): String? =
<b class="nc">&nbsp;        this.params.response?.momoMsg?.getNullablePaymentType()</b>
&nbsp;
&nbsp;    override fun updateTicketListWithFinalStatusCheck(res: TxnResponse?) {
<b class="nc">&nbsp;        val isFinal = res?.momoMsg?.isFinalStatus ?: false</b>
&nbsp;
<b class="nc">&nbsp;        if (isFinal) {</b>
<b class="nc">&nbsp;            delayTicketListJob?.cancel()</b>
<b class="nc">&nbsp;            updateTicketList(res, onResult = {</b>
<b class="nc">&nbsp;                handleOtherAddonsRender(res)</b>
&nbsp;            })
&nbsp;        } else {
<b class="nc">&nbsp;            delayTicketListJob?.cancel()</b>
<b class="nc">&nbsp;            delayTicketListJob = viewModelScope.launch {</b>
<b class="nc">&nbsp;                delay(params.renderTicketTime.toLong())</b>
<b class="nc">&nbsp;                updateTicketList(res)</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    override fun handleOtherAddonsRender(res: TxnResponse?) {
<b class="nc">&nbsp;        val isFinal = res?.momoMsg?.isFinalStatus ?: false</b>
<b class="nc">&nbsp;        if (!isFinal) return</b>
<b class="nc">&nbsp;        delayAddonsJob?.cancel()</b>
<b class="nc">&nbsp;        delayAddonsJob = viewModelScope.launch {</b>
<b class="nc">&nbsp;            delay(params.renderAddonsTime.toLong())</b>
<b class="nc">&nbsp;            state.update { it.copy(showOtherAddons = true) }</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun isBlockingTid(
&nbsp;        disableDetailMode: Boolean, transactionItem: TransactionItem
&nbsp;    ): Boolean =
<b class="nc">&nbsp;        disableDetailMode || transactionItem.isVirtualTID || transactionItem.disableTid || state.value.disableTID</b>
&nbsp;
&nbsp;    fun getTidColor(disableDetailMode: Boolean, transactionItem: TransactionItem) =
<b class="nc">&nbsp;        when (isBlockingTid(disableDetailMode, transactionItem)) {</b>
<b class="nc">&nbsp;            true -&gt; disableIDColor</b>
<b class="nc">&nbsp;            else -&gt; virtualIDColor</b>
&nbsp;        }
&nbsp;
&nbsp;    private fun getLimitedExtraInfo(extraInfo: List&lt;TextRowItem&gt;): List&lt;TextRowItem&gt; =
<b class="nc">&nbsp;        extraInfo.take(maxCustomExtraInfoCount) // Rules: limit 5 extra info rows</b>
&nbsp;
&nbsp;    private suspend fun buildTextRows(
&nbsp;        transactionItem: TransactionItem, extraInfo: List&lt;TextRowItem&gt;?, disableDetailMode: Boolean
&nbsp;    ): List&lt;TextRowItem&gt; {
<b class="nc">&nbsp;        return when (transactionItem.transactionStatus) {</b>
<b class="nc">&nbsp;            TransactionStatus.PENDING, TransactionStatus.SUCCESS -&gt; buildSuccessTextRows(</b>
<b class="nc">&nbsp;                transactionItem, extraInfo, disableDetailMode</b>
&nbsp;            )
&nbsp;
<b class="nc">&nbsp;            TransactionStatus.FAILED, TransactionStatus.PROCESSING -&gt; buildFailedTextRows(</b>
<b class="nc">&nbsp;                transactionItem, extraInfo, disableDetailMode</b>
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun buildCommonTextRows(
&nbsp;        transactionItem: TransactionItem,
<b class="nc">&nbsp;        extraInfo: List&lt;TextRowItem&gt;? = emptyList(),</b>
&nbsp;    ): MutableList&lt;TextRowItem&gt; {
<b class="nc">&nbsp;        val result: MutableList&lt;TextRowItem&gt; = mutableListOf()</b>
<b class="nc">&nbsp;        if (!transactionItem.serviceName.isNullOrBlank()) {</b>
<b class="nc">&nbsp;            result.add(</b>
<b class="nc">&nbsp;                TextRowItem(</b>
<b class="nc">&nbsp;                    key = getString(Res.string.serviceMerchant),</b>
<b class="nc">&nbsp;                    value = transactionItem.serviceName!!,</b>
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        result.add(</b>
<b class="nc">&nbsp;            TextRowItem(</b>
<b class="nc">&nbsp;                key = getString(Res.string.transactionTime),</b>
<b class="nc">&nbsp;                value = transactionItem.lastUpdate.toFormattedDateString(),</b>
&nbsp;            )
&nbsp;        )
&nbsp;
<b class="nc">&nbsp;        if (!extraInfo.isNullOrEmpty()) {</b>
<b class="nc">&nbsp;            result.addAll(getLimitedExtraInfo(extraInfo))</b>
&nbsp;        }
<b class="nc">&nbsp;        return result</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun buildSuccessTextRows(
&nbsp;        transactionItem: TransactionItem,
<b class="nc">&nbsp;        extraInfo: List&lt;TextRowItem&gt;? = emptyList(),</b>
&nbsp;        disableDetailMode: Boolean
&nbsp;    ): List&lt;TextRowItem&gt; {
<b class="nc">&nbsp;        val result = buildCommonTextRows(transactionItem, extraInfo)</b>
<b class="nc">&nbsp;        val showGamificationRows = state.value.gamificationData.hasCoinReward</b>
<b class="nc">&nbsp;        if (showGamificationRows) {</b>
<b class="nc">&nbsp;            val gamificationRows = buildGamificationTextRows(state.value.gamificationData.coinReward)</b>
<b class="nc">&nbsp;            result.addAll(gamificationRows)</b>
&nbsp;        }
<b class="nc">&nbsp;        if (transactionItem.transactionId.isNotBlank()) {</b>
<b class="nc">&nbsp;            val tidColor = virtualIDColor</b>
<b class="nc">&nbsp;            result.add(</b>
<b class="nc">&nbsp;                TextRowItem(</b>
<b class="nc">&nbsp;                    key = getString(Res.string.transactionDetail),</b>
<b class="nc">&nbsp;                    value = getString(Res.string.viewMore),</b>
<b class="nc">&nbsp;                    valueColor = tidColor,</b>
<b class="nc">&nbsp;                    action = TextRowAction.OPEN_BOTTOM_SHEET,</b>
<b class="nc">&nbsp;                    rightIcon = &quot;ic_arrow_chevron_right.webp&quot;,</b>
<b class="nc">&nbsp;                    rightIconTintColor = tidColor,</b>
<b class="nc">&nbsp;                    accessibilityId = &quot;text_tid&quot;</b>
&nbsp;                )
&nbsp;            )
&nbsp;        }
<b class="nc">&nbsp;        return result</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun buildFailedTextRows(
&nbsp;        transactionItem: TransactionItem,
<b class="nc">&nbsp;        extraInfo: List&lt;TextRowItem&gt;? = emptyList(),</b>
&nbsp;        disableDetailMode: Boolean
&nbsp;    ): List&lt;TextRowItem&gt; {
<b class="nc">&nbsp;        val result = buildCommonTextRows(transactionItem, extraInfo)</b>
<b class="nc">&nbsp;        if (transactionItem.transactionId.isNotBlank()) {</b>
<b class="nc">&nbsp;            val tidColor = getTidColor(disableDetailMode, transactionItem)</b>
<b class="nc">&nbsp;            result.add(</b>
<b class="nc">&nbsp;                TextRowItem(</b>
<b class="nc">&nbsp;                    key = getString(Res.string.transactionDetail),</b>
<b class="nc">&nbsp;                    value = transactionItem.transactionId,</b>
<b class="nc">&nbsp;                    valueColor = tidColor,</b>
<b class="nc">&nbsp;                    action = TextRowAction.GO_TO_DETAIL,</b>
<b class="nc">&nbsp;                    rightIcon = &quot;ic_arrow_chevron_right.webp&quot;,</b>
<b class="nc">&nbsp;                    rightIconTintColor = tidColor,</b>
<b class="nc">&nbsp;                    accessibilityId = &quot;text_tid&quot;</b>
&nbsp;                )
&nbsp;            )
&nbsp;        }
<b class="nc">&nbsp;        return result</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun buildGamificationTextRows(
&nbsp;        coinReward: GamificationResultData?
&nbsp;    ): List&lt;TextRowItem&gt; {
<b class="nc">&nbsp;        return listOf(</b>
<b class="nc">&nbsp;            TextRowItem(</b>
<b class="nc">&nbsp;                key = getString(Res.string.coinRewards),</b>
<b class="nc">&nbsp;                value = &quot;+${coinReward?.title}&quot;,</b>
<b class="nc">&nbsp;                valueColor = coinColor,</b>
<b class="nc">&nbsp;                action = TextRowAction.GO_TO_COIN,</b>
<b class="nc">&nbsp;                leftIcon = Images.ic_coin_reward,</b>
&nbsp;            )
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    private fun buildExtraInfo(config: TransactionResultTicketRevampConfig): List&lt;TextRowItem&gt; {
<b class="nc">&nbsp;        return config.extraInfo?.filter { it.isValid }?.map {</b>
<b class="nc">&nbsp;            TextRowItem(key = it.title ?: &quot;&quot;, value = it.value ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        } ?: emptyList()</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun buildActionButton(actionButton: ActionButton?): RevampButtonAction {
<b class="nc">&nbsp;        return RevampButtonAction(</b>
<b class="nc">&nbsp;            title = actionButton?.title,</b>
<b class="nc">&nbsp;            code = actionButton?.action?.code,</b>
<b class="nc">&nbsp;            params = actionButton?.action?.params,</b>
<b class="nc">&nbsp;            iconLeft = actionButton?.action?.iconLeft,</b>
<b class="nc">&nbsp;            iconRight = actionButton?.action?.iconRight,</b>
<b class="nc">&nbsp;            eventName = actionButton?.action?.eventName,</b>
<b class="nc">&nbsp;            eventParams = actionButton?.action?.eventParams,</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    override fun onWidgetLoadSuccess(
&nbsp;        widget: TransactionResultWidget, transactionItem: TransactionItem?
&nbsp;    ) {
<b class="nc">&nbsp;        super.onWidgetLoadSuccess(widget, transactionItem)</b>
<b class="nc">&nbsp;        logInfo(&quot;onWidgetLoadSuccess&quot;, widget.id)</b>
<b class="nc">&nbsp;        if (widget == TransactionResultWidget.Service &amp;&amp; !state._state.value.widgetServiceLoaded) {</b>
<b class="nc">&nbsp;            state.update {</b>
<b class="nc">&nbsp;                it.copy(</b>
<b class="nc">&nbsp;                    widgetServiceLoaded = true</b>
&nbsp;                )
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    override fun onWidgetLoadFailed(widget: TransactionResultWidget) {
<b class="nc">&nbsp;        super.onWidgetLoadFailed(widget)</b>
<b class="nc">&nbsp;        logInfo(&quot;onWidgetLoadFailed&quot;, widget.id)</b>
<b class="nc">&nbsp;        if (widget == TransactionResultWidget.Service &amp;&amp; !state._state.value.widgetServiceLoaded) {</b>
<b class="nc">&nbsp;            state.update {</b>
<b class="nc">&nbsp;                it.copy(</b>
<b class="nc">&nbsp;                    widgetServiceLoaded = true</b>
&nbsp;                )
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    override fun onWidgetLayoutChanged(
&nbsp;        widget: TransactionResultWidget,
&nbsp;        width: Int?,
&nbsp;        height: Int?,
&nbsp;        transactionItem: TransactionItem?
&nbsp;    ) {
<b class="nc">&nbsp;        super.onWidgetLayoutChanged(widget, width, height, transactionItem)</b>
<b class="nc">&nbsp;        logInfo(&quot;onWidgetLayoutChanged&quot;, &quot;${widget.id}-${width}-${height}&quot;)</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun checkABTestNextBestActionUI() {
<b class="nc">&nbsp;        val namespace = ABTestNamespace.KqgdRevamp2024.code</b>
<b class="nc">&nbsp;        val defaultFlow = ABTestTagname.Treatment1.code</b>
<b class="nc">&nbsp;        abTestUseCase.invoke(namespace, defaultFlow, janusFlow = true).onEach { tag -&gt;</b>
<b class="nc">&nbsp;            logger.i(&quot;[PayX] - checkABTestNextBestActionUI: $namespace-${tag}&quot;)</b>
<b class="nc">&nbsp;            state.update {</b>
<b class="nc">&nbsp;                it.copy(</b>
<b class="nc">&nbsp;                    abTestNBA = tag</b>
&nbsp;                )
&nbsp;            }
<b class="nc">&nbsp;        }.launchIn(viewModelScope)</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun &lt;T&gt; deepCompareWidgetConfig(ticket: TransactionTicketItem, config: T): Boolean {
<b class="nc">&nbsp;        val widgetConfig = config as? TransactionResultTicketRevampConfig ?: return false</b>
<b class="nc">&nbsp;        return widgetConfig.run {</b>
<b class="nc">&nbsp;            serviceName == ticket.serviceName &amp;&amp; message == ticket.messageInfo &amp;&amp; validExtraInfo.isNullOrEmpty() &amp;&amp; primaryButton?.let { it.title == ticket.revampPrimaryButton.title &amp;&amp; it.action?.code == ticket.revampPrimaryButton.code } == true &amp;&amp; secondaryButton?.let { it.title == ticket.revampSecondaryButton.title &amp;&amp; it.action?.code == ticket.revampSecondaryButton.code } == true</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-07-08 11:34</div>
</div>
</body>
</html>
