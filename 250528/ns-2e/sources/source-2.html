


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>MoMoCompose Coverage Report > NfcConsentRepository</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope: MoMoCompose<span class="separator">|</span>    <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">vn.momo.compose.payment.base.data.repository.consent</a>
</div>

<h1>Coverage Summary for Class: NfcConsentRepository (vn.momo.compose.payment.base.data.repository.consent)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">NfcConsentRepository</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/78)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/74)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/657)
  </span>
</td>
</tr>
  <tr>
    <td class="name">NfcConsentRepository$checkAbTestForShare$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$checkShouldConsent$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$fetchBankNeedConsent$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/94)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$fetchBankNeedConsent$2$2$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$fetchBankNeedConsent$2$2$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$fetchContent$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$fetchUserShareConsentStatus$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$fetchUserSyncConsentStatus$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getAvailableBank$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getConfig$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/280)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getConfig$2$availableBankDeferred$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getConfig$2$contentDefer$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getConfig$2$typeDefer$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getConfig$2$userBankDeferred$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getNFCConsentType$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$getUserBank$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">NfcConsentRepository$updateBankConsent$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/70)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/114)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/121)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1225)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package vn.momo.compose.payment.base.data.repository.consent
&nbsp;
&nbsp;import kotlinx.coroutines.CoroutineScope
&nbsp;import kotlinx.coroutines.Dispatchers
&nbsp;import kotlinx.coroutines.IO
&nbsp;import kotlinx.coroutines.async
&nbsp;import kotlinx.coroutines.awaitAll
&nbsp;import kotlinx.coroutines.coroutineScope
&nbsp;import kotlinx.coroutines.flow.firstOrNull
&nbsp;import kotlinx.coroutines.launch
&nbsp;import kotlinx.serialization.json.JsonObject
&nbsp;import vn.momo.compose.feedback.utils.add
&nbsp;import vn.momo.compose.payment.base.core.composeApi.ILogger
&nbsp;import vn.momo.compose.payment.base.core.composeApi.appFeatureConfig.IAppFeatureConfig
&nbsp;import vn.momo.compose.payment.base.core.composeApi.cdnConfig.ICDNConfig
&nbsp;import vn.momo.compose.payment.base.core.composeApi.route.IRouteApi
&nbsp;import vn.momo.compose.payment.base.core.composeApi.userProfile.IUserProfile
&nbsp;import vn.momo.compose.payment.base.core.service.trace.journey.FirebaseTrace
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.NfcConsentButtonClicked
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.NfcConsentRequest
&nbsp;import vn.momo.compose.payment.base.core.service.trace.model.journey.NfcConsentResponse
&nbsp;import vn.momo.compose.payment.base.data.dataSource.dto.request.UpdateAttributeItemDTO
&nbsp;import vn.momo.compose.payment.base.data.dataSource.dto.response.AbTestShareParamsDTO
&nbsp;import vn.momo.compose.payment.base.data.dataSource.dto.response.BankConsentConfigDTO
&nbsp;import vn.momo.compose.payment.base.data.dataSource.dto.response.PaymentConsentConfigDTO
&nbsp;import vn.momo.compose.payment.base.data.dataSource.dto.response.SofDTO
&nbsp;import vn.momo.compose.payment.base.data.dataSource.remote.ConsentRemoteDataSource
&nbsp;import vn.momo.compose.payment.base.domain.entities.BankConsent
&nbsp;import vn.momo.compose.payment.base.domain.entities.ConsentType
&nbsp;import vn.momo.compose.payment.base.domain.entities.NfcConsentType
&nbsp;import vn.momo.compose.payment.base.domain.repository.ConsentRepository
&nbsp;import vn.momo.compose.payment.base.domain.repository.LocalSofRepository
&nbsp;import vn.momo.compose.utils.datamapping.emptyJsonObject
&nbsp;import vn.momo.core.features.sofManager.constants.MoneySource
&nbsp;
<b class="nc">&nbsp;class NfcConsentRepository(</b>
<b class="nc">&nbsp;    private val profileApi: IUserProfile,</b>
<b class="nc">&nbsp;    private val sofSDK: LocalSofRepository,</b>
<b class="nc">&nbsp;    private val featureConfig: IAppFeatureConfig,</b>
<b class="nc">&nbsp;    private val cdnConfig: ICDNConfig,</b>
<b class="nc">&nbsp;    private val consentRemote: ConsentRemoteDataSource,</b>
<b class="nc">&nbsp;    private val logger: ILogger,</b>
<b class="nc">&nbsp;    private val abTestApi: IRouteApi</b>
&nbsp;) : ConsentRepository {
<b class="nc">&nbsp;    var consentList: List&lt;BankConsentConfigDTO&gt; = emptyList()</b>
<b class="nc">&nbsp;    override suspend fun getConfig(): ConsentType = coroutineScope {</b>
<b class="nc">&nbsp;        val typeDefer = async { getNFCConsentType() }</b>
<b class="nc">&nbsp;        val userBankDeferred = async { getUserBank() }</b>
<b class="nc">&nbsp;        val availableBankDeferred = async { getAvailableBank() }</b>
<b class="nc">&nbsp;        val contentDefer = async { fetchContent() }</b>
&nbsp;
<b class="nc">&nbsp;        val type = typeDefer.await()</b>
<b class="nc">&nbsp;        val bankToConsent =</b>
<b class="nc">&nbsp;            fetchBankNeedConsent(type, userBankDeferred.await(), availableBankDeferred.await())</b>
&nbsp;
<b class="nc">&nbsp;        if (bankToConsent.isEmpty()) return@coroutineScope ConsentType.None</b>
&nbsp;
<b class="nc">&nbsp;        val content = contentDefer.await()</b>
<b class="nc">&nbsp;        val bankInfo = bankToConsent.mapValues { (bankCode, bankDTO) -&gt;</b>
<b class="nc">&nbsp;            BankConsent(</b>
<b class="nc">&nbsp;                bankName = bankDTO?.bankName ?: &quot;&quot;,</b>
<b class="nc">&nbsp;                content = (content?.get(bankCode) as? JsonObject)?.get(if (type == NfcConsentType.ShareNFC) &quot;shareContentConsent&quot; else &quot;contentConsent&quot;) as? JsonObject</b>
<b class="nc">&nbsp;                    ?: emptyJsonObject()</b>
<b class="nc">&nbsp;            )</b>
<b class="nc">&nbsp;        }.filterValues { it.content.isNotEmpty() }</b>
&nbsp;
<b class="nc">&nbsp;        return@coroutineScope if (bankInfo.values.isEmpty()) ConsentType.None</b>
<b class="nc">&nbsp;        else ConsentType.NFC(bankInfo = bankInfo)</b>
&nbsp;    }
&nbsp;
&nbsp;    fun updateConsent(type: ConsentType, bankCodes: List&lt;String&gt;) {
<b class="nc">&nbsp;        consentList.filter { it.bankCode in bankCodes }.forEachIndexed { idx, bankConsent -&gt;</b>
<b class="nc">&nbsp;            updateBankConsent(type, idx, bankConsent)</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private suspend fun fetchBankNeedConsent(
&nbsp;        type: NfcConsentType,
&nbsp;        userBanks: Map&lt;String, SofDTO&gt;,
&nbsp;        banksConfig: List&lt;BankConsentConfigDTO&gt;
<b class="nc">&nbsp;    ) = coroutineScope {</b>
<b class="nc">&nbsp;        banksConfig.filter { it.bankCode != null &amp;&amp; userBanks[it.bankCode] != null }</b>
<b class="nc">&nbsp;            .map { bank -&gt;</b>
<b class="nc">&nbsp;                if (type == NfcConsentType.SyncNFC) {</b>
<b class="nc">&nbsp;                    async { fetchUserSyncConsentStatus(bank) }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    async { fetchUserShareConsentStatus(bank) }</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
<b class="nc">&nbsp;            .awaitAll()</b>
<b class="nc">&nbsp;            .filter { it != null &amp;&amp; !it.bankCode.isNullOrEmpty() }</b>
<b class="nc">&nbsp;            .associateBy { it!!.bankCode!! }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Updates the consent for a specific bank.
&nbsp;     *
&nbsp;     * @param type The type of consent.
&nbsp;     * @param index The index of the bank consent in the list.
&nbsp;     * @param bankConsent The bank consent configuration.
&nbsp;     */
&nbsp;    private fun updateBankConsent(
&nbsp;        type: ConsentType, index: Int, bankConsent: BankConsentConfigDTO
&nbsp;    ) {
<b class="nc">&nbsp;        if (bankConsent.miniAppId.isNullOrEmpty() || bankConsent.partnerCode.isNullOrEmpty() || bankConsent.attributeValue.isNullOrEmpty()) {</b>
&nbsp;            return
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        CoroutineScope(Dispatchers.IO).launch {</b>
<b class="nc">&nbsp;            FirebaseTrace.track(</b>
<b class="nc">&nbsp;                NfcConsentButtonClicked(</b>
<b class="nc">&nbsp;                    attributeId = bankConsent.attributeValue,</b>
<b class="nc">&nbsp;                    partnerCode = bankConsent.partnerCode,</b>
<b class="nc">&nbsp;                    type = when (type) {</b>
<b class="nc">&nbsp;                        is ConsentType.NFC -&gt; &quot;consent_nfc&quot;</b>
<b class="nc">&nbsp;                        is ConsentType.Mixed -&gt; &quot;NĐ13_NFC&quot;</b>
<b class="nc">&nbsp;                        else -&gt; &quot;&quot;</b>
&nbsp;                    },
<b class="nc">&nbsp;                    bankCode = bankConsent.bankCode ?: &quot;&quot;</b>
&nbsp;                )
&nbsp;            )
<b class="nc">&nbsp;            consentRemote.updateConsent(</b>
<b class="nc">&nbsp;                needAuthen = index == 0,</b>
<b class="nc">&nbsp;                miniAppId = bankConsent.miniAppId,</b>
<b class="nc">&nbsp;                attributeList = listOf(UpdateAttributeItemDTO(attribute = bankConsent.attributeValue)),</b>
<b class="nc">&nbsp;                partnerCode = bankConsent.partnerCode</b>
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun fetchContent(): JsonObject? {
<b class="nc">&nbsp;        return cdnConfig.get(&quot;https://static.momocdn.net/app/json/payment/consent_nfc_content.json&quot;)</b>
<b class="nc">&nbsp;            .also {</b>
<b class="nc">&nbsp;                logger.i(&quot;[Payment] NfcConsentRepository.getCDN &gt;&gt; $it &quot;)</b>
<b class="nc">&nbsp;            }</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun fetchUserSyncConsentStatus(bank: BankConsentConfigDTO): BankConsentConfigDTO? {
<b class="nc">&nbsp;        if (bank.attributeValue == null || bank.miniAppId == null || bank.partnerCode == null) return null</b>
<b class="nc">&nbsp;        return if (checkShouldConsent(bank.attributeValue, bank.partnerCode, bank.miniAppId)) {</b>
<b class="nc">&nbsp;            consentList = consentList.add(bank)</b>
<b class="nc">&nbsp;            bank</b>
<b class="nc">&nbsp;        } else null</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun fetchUserShareConsentStatus(bank: BankConsentConfigDTO): BankConsentConfigDTO? {
<b class="nc">&nbsp;        val shareData = bank.share</b>
<b class="nc">&nbsp;        if (shareData?.miniAppId == null || shareData.partnerCode == null || shareData.attributeValue == null || shareData.abTestParams == null) return null</b>
<b class="nc">&nbsp;        if (!checkAbTestForShare(shareData.abTestParams)) return null</b>
<b class="nc">&nbsp;        return if (checkShouldConsent(</b>
<b class="nc">&nbsp;                shareData.attributeValue, shareData.partnerCode, shareData.miniAppId</b>
&nbsp;            )
&nbsp;        ) {
<b class="nc">&nbsp;            val parsed = bank.copy(</b>
<b class="nc">&nbsp;                attributeValue = shareData.attributeValue,</b>
<b class="nc">&nbsp;                partnerCode = shareData.partnerCode,</b>
<b class="nc">&nbsp;                miniAppId = shareData.miniAppId</b>
&nbsp;            )
<b class="nc">&nbsp;            consentList = consentList.add(parsed)</b>
<b class="nc">&nbsp;            parsed</b>
<b class="nc">&nbsp;        } else null</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun checkAbTestForShare(params: AbTestShareParamsDTO): Boolean {
<b class="nc">&nbsp;        return params.namespace?.let { namespace -&gt;</b>
<b class="nc">&nbsp;            abTestApi.checkAbTest(namespace, params.defaultFlow ?: &quot;control&quot;, true).also {</b>
<b class="nc">&nbsp;                logger.i(&quot;[Payment] NfcConsentRepository.checkAbTestForShare:: $namespace &gt;&gt; $it&quot;)</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        } == &quot;whitelist&quot;</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun checkShouldConsent(
&nbsp;        attributeValue: String, partnerCode: String, miniAppId: String
&nbsp;    ): Boolean {
<b class="nc">&nbsp;        FirebaseTrace.track(</b>
<b class="nc">&nbsp;            NfcConsentRequest(</b>
<b class="nc">&nbsp;                attributeId = attributeValue,</b>
<b class="nc">&nbsp;                partnerCode = partnerCode,</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        val data = consentRemote.getConsent(</b>
<b class="nc">&nbsp;            miniAppId = miniAppId, partnerCode = partnerCode, fields = attributeValue</b>
&nbsp;        )
<b class="nc">&nbsp;        val resp = data?.momoMsg ?: return false</b>
<b class="nc">&nbsp;        val attributes = resp.attributeList?.mapNotNull { item -&gt; item.attribute }</b>
<b class="nc">&nbsp;        val isNotConsent = attributes.isNullOrEmpty() || !attributes.contains(attributeValue)</b>
<b class="nc">&nbsp;        FirebaseTrace.track(</b>
<b class="nc">&nbsp;            NfcConsentResponse(</b>
<b class="nc">&nbsp;                attributeId = attributeValue,</b>
<b class="nc">&nbsp;                partnerCode = partnerCode,</b>
<b class="nc">&nbsp;                value = if (isNotConsent) 0 else 1,</b>
<b class="nc">&nbsp;                errorCode = data.errorCode,</b>
&nbsp;            )
&nbsp;        )
<b class="nc">&nbsp;        return isNotConsent</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun getNFCConsentType(): NfcConsentType {
<b class="nc">&nbsp;        val userKycStatus = profileApi.getData().firstOrNull().also {</b>
<b class="nc">&nbsp;            logger.i(&quot;[Payment] NfcConsentRepository.shouldGetConfig $it &gt;&gt; ${it?.kycC06Verified?.toInt()}&quot;)</b>
<b class="nc">&nbsp;        }?.kycC06Verified</b>
&nbsp;
<b class="nc">&nbsp;        return userKycStatus?.let {</b>
<b class="nc">&nbsp;            if (listOf(1, 2, 8).contains(it.toInt())) NfcConsentType.ShareNFC</b>
<b class="nc">&nbsp;            else NfcConsentType.SyncNFC</b>
<b class="nc">&nbsp;        } ?: NfcConsentType.SyncNFC</b>
&nbsp;    }
&nbsp;
&nbsp;    @Suppress(&quot;UNCHECKED_CAST&quot;)
&nbsp;    private suspend fun getUserBank(): Map&lt;String, SofDTO&gt; {
<b class="nc">&nbsp;        return (sofSDK.getLocalSofSdk().firstOrNull()</b>
<b class="nc">&nbsp;            .also { logger.i(&quot;[Payment] NfcConsentRepository.sofSDK $it&quot;) }</b>
<b class="nc">&nbsp;            ?.filter { sof -&gt; sof.moneySource == MoneySource.Bank.id }</b>
<b class="nc">&nbsp;            ?: emptyList()).also { logger.i(&quot;[Payment] NfcConsentRepository.getUserBank ${it.map { sof -&gt; sof.bankCode }}&quot;) }</b>
<b class="nc">&nbsp;            .associateBy { it.bankCode }.filterKeys { !it.isNullOrEmpty() } as Map&lt;String, SofDTO&gt;</b>
&nbsp;    }
&nbsp;
&nbsp;    private suspend fun getAvailableBank(): List&lt;BankConsentConfigDTO&gt; {
<b class="nc">&nbsp;        return (featureConfig.getById(&quot;payment_consent&quot;, PaymentConsentConfigDTO.serializer())</b>
<b class="nc">&nbsp;            .firstOrNull()?.param?.nfcBankMap?.filterNotNull() ?: emptyList()).also {</b>
<b class="nc">&nbsp;            logger.i(&quot;[Payment] NfcConsentRepository.getAvailableBank $it&quot;)</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-07-08 10:52</div>
</div>
</body>
</html>
